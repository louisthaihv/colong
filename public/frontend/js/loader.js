(function(){var e=this,t=e._,n={},i=Array.prototype,r=Object.prototype,o=Function.prototype,a=i.push,s=i.slice,c=i.concat,u=r.toString,l=r.hasOwnProperty,f=i.forEach,d=i.map,p=i.reduce,_=i.reduceRight,v=i.filter,g=i.every,m=i.some,h=i.indexOf,b=i.lastIndexOf,y=Array.isArray,w=Object.keys,x=o.bind,k=function(e){return e instanceof k?e:this instanceof k?void(this._wrapped=e):new k(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports._=k):e._=k,
k.VERSION="1.6.0";var z=k.each=k.forEach=function(e,t,i){if(null==e)return e;if(f&&e.forEach===f)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(i,e[r],r,e)===n)return}else for(var a=k.keys(e),r=0,o=a.length;o>r;r++)if(t.call(i,e[a[r]],a[r],e)===n)return;return e};k.map=k.collect=function(e,t,n){var i=[];return null==e?i:d&&e.map===d?e.map(t,n):(z(e,function(e,r,o){i.push(t.call(n,e,r,o))}),i)};var E="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(e,t,n,i){
var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return i&&(t=k.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(z(e,function(e,o,a){r?n=t.call(i,n,e,o,a):(n=e,r=!0)}),!r)throw new TypeError(E);return n},k.reduceRight=k.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),_&&e.reduceRight===_)return i&&(t=k.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var a=k.keys(e);o=a.length}if(z(e,function(s,c,u){c=a?a[--o]:--o,r?n=t.call(i,n,e[c],c,u):(n=e[c],
r=!0)}),!r)throw new TypeError(E);return n},k.find=k.detect=function(e,t,n){var i;return T(e,function(e,r,o){return t.call(n,e,r,o)?(i=e,!0):void 0}),i},k.filter=k.select=function(e,t,n){var i=[];return null==e?i:v&&e.filter===v?e.filter(t,n):(z(e,function(e,r,o){t.call(n,e,r,o)&&i.push(e)}),i)},k.reject=function(e,t,n){return k.filter(e,function(e,i,r){return!t.call(n,e,i,r)},n)},k.every=k.all=function(e,t,i){t||(t=k.identity);var r=!0;return null==e?r:g&&e.every===g?e.every(t,i):(z(e,function(e,o,a){
return(r=r&&t.call(i,e,o,a))?void 0:n}),!!r)};var T=k.some=k.any=function(e,t,i){t||(t=k.identity);var r=!1;return null==e?r:m&&e.some===m?e.some(t,i):(z(e,function(e,o,a){return r||(r=t.call(i,e,o,a))?n:void 0}),!!r)};k.contains=k.include=function(e,t){return null==e?!1:h&&e.indexOf===h?-1!=e.indexOf(t):T(e,function(e){return e===t})},k.invoke=function(e,t){var n=s.call(arguments,2),i=k.isFunction(t);return k.map(e,function(e){return(i?t:e[t]).apply(e,n)})},k.pluck=function(e,t){return k.map(e,k.property(t));

},k.where=function(e,t){return k.filter(e,k.matches(t))},k.findWhere=function(e,t){return k.find(e,k.matches(t))},k.max=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var i=-(1/0),r=-(1/0);return z(e,function(e,o,a){var s=t?t.call(n,e,o,a):e;s>r&&(i=e,r=s)}),i},k.min=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var i=1/0,r=1/0;return z(e,function(e,o,a){var s=t?t.call(n,e,o,a):e;r>s&&(i=e,r=s)}),i},
k.shuffle=function(e){var t,n=0,i=[];return z(e,function(e){t=k.random(n++),i[n-1]=i[t],i[t]=e}),i},k.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=k.values(e)),e[k.random(e.length-1)]):k.shuffle(e).slice(0,Math.max(0,t))};var C=function(e){return null==e?k.identity:k.isFunction(e)?e:k.property(e)};k.sortBy=function(e,t,n){return t=C(t),k.pluck(k.map(e,function(e,i,r){return{value:e,index:i,criteria:t.call(n,e,i,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){
if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var S=function(e){return function(t,n,i){var r={};return n=C(n),z(t,function(o,a){var s=n.call(i,o,a,t);e(r,s,o)}),r}};k.groupBy=S(function(e,t,n){k.has(e,t)?e[t].push(n):e[t]=[n]}),k.indexBy=S(function(e,t,n){e[t]=n}),k.countBy=S(function(e,t){k.has(e,t)?e[t]++:e[t]=1}),k.sortedIndex=function(e,t,n,i){n=C(n);for(var r=n.call(i,t),o=0,a=e.length;a>o;){var s=o+a>>>1;n.call(i,e[s])<r?o=s+1:a=s}return o},k.toArray=function(e){
return e?k.isArray(e)?s.call(e):e.length===+e.length?k.map(e,k.identity):k.values(e):[]},k.size=function(e){return null==e?0:e.length===+e.length?e.length:k.keys(e).length},k.first=k.head=k.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:s.call(e,0,t)},k.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},k.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},k.rest=k.tail=k.drop=function(e,t,n){return s.call(e,null==t||n?1:t);

},k.compact=function(e){return k.filter(e,k.identity)};var j=function(e,t,n){return t&&k.every(e,k.isArray)?c.apply(n,e):(z(e,function(e){k.isArray(e)||k.isArguments(e)?t?a.apply(n,e):j(e,t,n):n.push(e)}),n)};k.flatten=function(e,t){return j(e,t,[])},k.without=function(e){return k.difference(e,s.call(arguments,1))},k.partition=function(e,t){var n=[],i=[];return z(e,function(e){(t(e)?n:i).push(e)}),[n,i]},k.uniq=k.unique=function(e,t,n,i){k.isFunction(t)&&(i=n,n=t,t=!1);var r=n?k.map(e,n,i):e,o=[],a=[];

return z(r,function(n,i){(t?i&&a[a.length-1]===n:k.contains(a,n))||(a.push(n),o.push(e[i]))}),o},k.union=function(){return k.uniq(k.flatten(arguments,!0))},k.intersection=function(e){var t=s.call(arguments,1);return k.filter(k.uniq(e),function(e){return k.every(t,function(t){return k.contains(t,e)})})},k.difference=function(e){var t=c.apply(i,s.call(arguments,1));return k.filter(e,function(e){return!k.contains(t,e)})},k.zip=function(){for(var e=k.max(k.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=k.pluck(arguments,""+n);

return t},k.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},k.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return i=k.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,r+n):n}if(h&&e.indexOf===h)return e.indexOf(t,n);for(;r>i;i++)if(e[i]===t)return i;return-1},k.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(b&&e.lastIndexOf===b)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);

for(var r=i?n:e.length;r--;)if(e[r]===t)return r;return-1},k.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,o=new Array(i);i>r;)o[r++]=e,e+=n;return o};var O=function(){};k.bind=function(e,t){var n,i;if(x&&e.bind===x)return x.apply(e,s.call(arguments,1));if(!k.isFunction(e))throw new TypeError;return n=s.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(s.call(arguments)));O.prototype=e.prototype;

var r=new O;O.prototype=null;var o=e.apply(r,n.concat(s.call(arguments)));return Object(o)===o?o:r}},k.partial=function(e){var t=s.call(arguments,1);return function(){for(var n=0,i=t.slice(),r=0,o=i.length;o>r;r++)i[r]===k&&(i[r]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},k.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return z(t,function(t){e[t]=k.bind(e[t],e)}),e},k.memoize=function(e,t){
var n={};return t||(t=k.identity),function(){var i=t.apply(this,arguments);return k.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},k.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},k.defer=function(e){return k.delay.apply(k,[e,1].concat(s.call(arguments,1)))},k.throttle=function(e,t,n){var i,r,o,a=null,s=0;n||(n={});var c=function(){s=n.leading===!1?0:k.now(),a=null,o=e.apply(i,r),i=r=null};return function(){var u=k.now();s||n.leading!==!1||(s=u);

var l=t-(u-s);return i=this,r=arguments,0>=l?(clearTimeout(a),a=null,s=u,o=e.apply(i,r),i=r=null):a||n.trailing===!1||(a=setTimeout(c,l)),o}},k.debounce=function(e,t,n){var i,r,o,a,s,c=function(){var u=k.now()-a;t>u?i=setTimeout(c,t-u):(i=null,n||(s=e.apply(o,r),o=r=null))};return function(){o=this,r=arguments,a=k.now();var u=n&&!i;return i||(i=setTimeout(c,t)),u&&(s=e.apply(o,r),o=r=null),s}},k.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},k.wrap=function(e,t){
return k.partial(t,e)},k.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},k.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},k.keys=function(e){if(!k.isObject(e))return[];if(w)return w(e);var t=[];for(var n in e)k.has(e,n)&&t.push(n);return t},k.values=function(e){for(var t=k.keys(e),n=t.length,i=new Array(n),r=0;n>r;r++)i[r]=e[t[r]];return i},k.pairs=function(e){for(var t=k.keys(e),n=t.length,i=new Array(n),r=0;n>r;r++)i[r]=[t[r],e[t[r]]];

return i},k.invert=function(e){for(var t={},n=k.keys(e),i=0,r=n.length;r>i;i++)t[e[n[i]]]=n[i];return t},k.functions=k.methods=function(e){var t=[];for(var n in e)k.isFunction(e[n])&&t.push(n);return t.sort()},k.extend=function(e){return z(s.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},k.pick=function(e){var t={},n=c.apply(i,s.call(arguments,1));return z(n,function(n){n in e&&(t[n]=e[n])}),t},k.omit=function(e){var t={},n=c.apply(i,s.call(arguments,1));for(var r in e)k.contains(n,r)||(t[r]=e[r]);

return t},k.defaults=function(e){return z(s.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},k.clone=function(e){return k.isObject(e)?k.isArray(e)?e.slice():k.extend({},e):e},k.tap=function(e,t){return t(e),e};var N=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof k&&(e=e._wrapped),t instanceof k&&(t=t._wrapped);var r=u.call(e);if(r!=u.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":
return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return i[o]==t;var a=e.constructor,s=t.constructor;if(a!==s&&!(k.isFunction(a)&&a instanceof a&&k.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),i.push(t);var c=0,l=!0;

if("[object Array]"==r){if(c=e.length,l=c==t.length)for(;c--&&(l=N(e[c],t[c],n,i)););}else{for(var f in e)if(k.has(e,f)&&(c++,!(l=k.has(t,f)&&N(e[f],t[f],n,i))))break;if(l){for(f in t)if(k.has(t,f)&&!c--)break;l=!c}}return n.pop(),i.pop(),l};k.isEqual=function(e,t){return N(e,t,[],[])},k.isEmpty=function(e){if(null==e)return!0;if(k.isArray(e)||k.isString(e))return 0===e.length;for(var t in e)if(k.has(e,t))return!1;return!0},k.isElement=function(e){return!(!e||1!==e.nodeType)},k.isArray=y||function(e){
return"[object Array]"==u.call(e)},k.isObject=function(e){return e===Object(e)},z(["Arguments","Function","String","Number","Date","RegExp"],function(e){k["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),k.isArguments(arguments)||(k.isArguments=function(e){return!(!e||!k.has(e,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(e){return"function"==typeof e}),k.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},k.isNaN=function(e){return k.isNumber(e)&&e!=+e},k.isBoolean=function(e){
return e===!0||e===!1||"[object Boolean]"==u.call(e)},k.isNull=function(e){return null===e},k.isUndefined=function(e){return void 0===e},k.has=function(e,t){return l.call(e,t)},k.noConflict=function(){return e._=t,this},k.identity=function(e){return e},k.constant=function(e){return function(){return e}},k.property=function(e){return function(t){return t[e]}},k.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},k.times=function(e,t,n){for(var i=Array(Math.max(0,e)),r=0;e>r;r++)i[r]=t.call(n,r);

return i},k.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},k.now=Date.now||function(){return(new Date).getTime()};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};A.unescape=k.invert(A.escape);var I={escape:new RegExp("["+k.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+k.keys(A.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(e){k[e]=function(t){return null==t?"":(""+t).replace(I[e],function(t){return A[e][t];

})}}),k.result=function(e,t){if(null==e)return void 0;var n=e[t];return k.isFunction(n)?n.call(e):n},k.mixin=function(e){z(k.functions(e),function(t){var n=k[t]=e[t];k.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),q.call(this,n.apply(k,e))}})};var L=0;k.uniqueId=function(e){var t=++L+"";return e?e+t:t},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var $=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028",
"\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(e,t,n){var i;n=k.defaults({},n,k.templateSettings);var r=new RegExp([(n.escape||$).source,(n.interpolate||$).source,(n.evaluate||$).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(r,function(t,n,i,r,s){return a+=e.slice(o,s).replace(M,function(e){return"\\"+R[e]}),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),o=s+t.length,t}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),
a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(n.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return i(t,k);var c=function(e){return i.call(this,e,k)};return c.source="function("+(n.variable||"obj")+"){\n"+a+"}",c},k.chain=function(e){return k(e).chain()};var q=function(e){return this._chain?k(e).chain():e};k.mixin(k),z(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];k.prototype[e]=function(){
var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],q.call(this,n)}}),z(["concat","join","slice"],function(e){var t=i[e];k.prototype[e]=function(){return q.call(this,t.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return k})}).call(this),function(e){function t(n,i){function r(e){if(r[e]!==v)return r[e];

var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=r("json-stringify")&&r("json-parse");else{var n,s='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var u=i.stringify,l="function"==typeof u&&h;if(l){(n=function(){return 1}).toJSON=n;try{l="0"===u(0)&&"0"===u(new o)&&'""'==u(new a)&&u(m)===v&&u(v)===v&&u()===v&&"1"===u(n)&&"[1]"==u([n])&&"[null]"==u([v])&&"null"==u(null)&&"[null,null,null]"==u([v,m,null])&&u({a:[n,!0,!1,null,"\x00\b\n\f\r	"]})==s&&"1"===u(null,n)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==u(new c(-1));

}catch(f){l=!1}}t=l}if("json-parse"==e){var d=i.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){n=d(s);var p=5==n.a.length&&1===n.a[0];if(p){try{p=!d('"	"')}catch(f){}if(p)try{p=1!==d("01")}catch(f){}if(p)try{p=1!==d("1.")}catch(f){}}}}catch(f){p=!1}t=p}}return r[e]=!!t}n||(n=e.Object()),i||(i=e.Object());var o=n.Number||e.Number,a=n.String||e.String,s=n.Object||e.Object,c=n.Date||e.Date,u=n.SyntaxError||e.SyntaxError,l=n.TypeError||e.TypeError,f=n.Math||e.Math,d=n.JSON||e.JSON;"object"==typeof d&&d&&(i.stringify=d.stringify,
i.parse=d.parse);var p,_,v,g=s.prototype,m=g.toString,h=new c(-0xc782b5b800cec);try{h=-109252==h.getUTCFullYear()&&0===h.getUTCMonth()&&1===h.getUTCDate()&&10==h.getUTCHours()&&37==h.getUTCMinutes()&&6==h.getUTCSeconds()&&708==h.getUTCMilliseconds()}catch(b){}if(!r("json")){var y="[object Function]",w="[object Date]",x="[object Number]",k="[object String]",z="[object Array]",E="[object Boolean]",T=r("bug-string-char-index");if(!h)var C=f.floor,S=[0,31,59,90,120,151,181,212,243,273,304,334],j=function(e,t){
return S[t]+365*(e-1970)+C((e-1969+(t=+(t>1)))/4)-C((e-1901+t)/100)+C((e-1601+t)/400)};(p=g.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=m?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)});var O={"boolean":1,number:1,string:1,undefined:1},N=function(e,t){var n=typeof e[t];

return"object"==n?!!e[t]:!O[n]};if(_=function(e,t){var n,i,r,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(r in i)p.call(i,r)&&o++;return n=i=null,o?_=2==o?function(e,t){var n,i={},r=m.call(e)==y;for(n in e)r&&"prototype"==n||p.call(i,n)||!(i[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,i,r=m.call(e)==y;for(n in e)r&&"prototype"==n||!p.call(e,n)||(i="constructor"===n)||t(n);(i||p.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],
_=function(e,t){var n,r,o=m.call(e)==y,a=!o&&"function"!=typeof e.constructor&&N(e,"hasOwnProperty")?e.hasOwnProperty:p;for(n in e)o&&"prototype"==n||!a.call(e,n)||t(n);for(r=i.length;n=i[--r];a.call(e,n)&&t(n));}),_(e,t)},!r("json-stringify")){var A={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},I="000000",L=function(e,t){return(I+(t||0)).slice(-e)},$="\\u00",R=function(e){for(var t='"',n=0,i=e.length,r=!T||i>10,o=r&&(T?e.split(""):e);i>n;n++){var a=e.charCodeAt(n);switch(a){case 8:
case 9:case 10:case 12:case 13:case 34:case 92:t+=A[a];break;default:if(32>a){t+=$+L(2,a.toString(16));break}t+=r?o[n]:e.charAt(n)}}return t+'"'},M=function(e,t,n,i,r,o,a){var s,c,u,f,d,g,h,b,y,T,S,O,N,A,I,$;try{s=t[e]}catch(q){}if("object"==typeof s&&s)if(c=m.call(s),c!=w||p.call(s,"toJSON"))"function"==typeof s.toJSON&&(c!=x&&c!=k&&c!=z||p.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(j){for(d=C(s/864e5),u=C(d/365.2425)+1970-1;j(u+1,0)<=d;u++);for(f=C((d-j(u,0))/30.42);j(u,f+1)<=d;f++);
d=1+d-j(u,f),g=(s%864e5+864e5)%864e5,h=C(g/36e5)%24,b=C(g/6e4)%60,y=C(g/1e3)%60,T=g%1e3}else u=s.getUTCFullYear(),f=s.getUTCMonth(),d=s.getUTCDate(),h=s.getUTCHours(),b=s.getUTCMinutes(),y=s.getUTCSeconds(),T=s.getUTCMilliseconds();s=(0>=u||u>=1e4?(0>u?"-":"+")+L(6,0>u?-u:u):L(4,u))+"-"+L(2,f+1)+"-"+L(2,d)+"T"+L(2,h)+":"+L(2,b)+":"+L(2,y)+"."+L(3,T)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if(c=m.call(s),c==E)return""+s;if(c==x)return s>-1/0&&1/0>s?""+s:"null";if(c==k)return R(""+s);

if("object"==typeof s){for(A=a.length;A--;)if(a[A]===s)throw l();if(a.push(s),S=[],I=o,o+=r,c==z){for(N=0,A=s.length;A>N;N++)O=M(N,s,n,i,r,o,a),S.push(O===v?"null":O);$=S.length?r?"[\n"+o+S.join(",\n"+o)+"\n"+I+"]":"["+S.join(",")+"]":"[]"}else _(i||s,function(e){var t=M(e,s,n,i,r,o,a);t!==v&&S.push(R(e)+":"+(r?" ":"")+t)}),$=S.length?r?"{\n"+o+S.join(",\n"+o)+"\n"+I+"}":"{"+S.join(",")+"}":"{}";return a.pop(),$}};i.stringify=function(e,t,n){var i,r,o,a;if("function"==typeof t||"object"==typeof t&&t)if((a=m.call(t))==y)r=t;
else if(a==z){o={};for(var s,c=0,u=t.length;u>c;s=t[c++],a=m.call(s),(a==k||a==x)&&(o[s]=1));}if(n)if((a=m.call(n))==x){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else a==k&&(i=n.length<=10?n:n.slice(0,10));return M("",(s={},s[""]=e,s),r,o,i,"",[])}}if(!r("json-parse")){var q,D,P=a.fromCharCode,H={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},U=function(){throw q=D=null,u()},F=function(){for(var e,t,n,i,r,o=D,a=o.length;a>q;)switch(r=o.charCodeAt(q)){case 9:case 10:
case 13:case 32:q++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?o.charAt(q):o[q],q++,e;case 34:for(e="@",q++;a>q;)if(r=o.charCodeAt(q),32>r)U();else if(92==r)switch(r=o.charCodeAt(++q)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=H[r],q++;break;case 117:for(t=++q,n=q+4;n>q;q++)r=o.charCodeAt(q),r>=48&&57>=r||r>=97&&102>=r||r>=65&&70>=r||U();e+=P("0x"+o.slice(t,q));break;default:U()}else{if(34==r)break;for(r=o.charCodeAt(q),t=q;r>=32&&92!=r&&34!=r;)r=o.charCodeAt(++q);

e+=o.slice(t,q)}if(34==o.charCodeAt(q))return q++,e;U();default:if(t=q,45==r&&(i=!0,r=o.charCodeAt(++q)),r>=48&&57>=r){for(48==r&&(r=o.charCodeAt(q+1),r>=48&&57>=r)&&U(),i=!1;a>q&&(r=o.charCodeAt(q),r>=48&&57>=r);q++);if(46==o.charCodeAt(q)){for(n=++q;a>n&&(r=o.charCodeAt(n),r>=48&&57>=r);n++);n==q&&U(),q=n}if(r=o.charCodeAt(q),101==r||69==r){for(r=o.charCodeAt(++q),(43==r||45==r)&&q++,n=q;a>n&&(r=o.charCodeAt(n),r>=48&&57>=r);n++);n==q&&U(),q=n}return+o.slice(t,q)}if(i&&U(),"true"==o.slice(q,q+4))return q+=4,
!0;if("false"==o.slice(q,q+5))return q+=5,!1;if("null"==o.slice(q,q+4))return q+=4,null;U()}return"$"},B=function(e){var t,n;if("$"==e&&U(),"string"==typeof e){if("@"==(T?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=F(),"]"!=e;n||(n=!0))n&&(","==e?(e=F(),"]"==e&&U()):U()),","==e&&U(),t.push(B(e));return t}if("{"==e){for(t={};e=F(),"}"!=e;n||(n=!0))n&&(","==e?(e=F(),"}"==e&&U()):U()),(","==e||"string"!=typeof e||"@"!=(T?e.charAt(0):e[0])||":"!=F())&&U(),t[e.slice(1)]=B(F());return t}U();

}return e},X=function(e,t,n){var i=J(e,t,n);i===v?delete e[t]:e[t]=i},J=function(e,t,n){var i,r=e[t];if("object"==typeof r&&r)if(m.call(r)==z)for(i=r.length;i--;)X(r,i,n);else _(r,function(e){X(r,e,n)});return n.call(e,t,r)};i.parse=function(e,t){var n,i;return q=0,D=""+e,n=B(F()),"$"!=F()&&U(),q=D=null,t&&m.call(t)==y?J((i={},i[""]=n,i),"",t):n}}}return i.runInContext=t,i}var n="function"==typeof define&&define.amd,i="object"==typeof global&&global;if(!i||i.global!==i&&i.window!==i||(e=i),"object"!=typeof exports||!exports||exports.nodeType||n){
var r=e.JSON,o=t(e,e.JSON3={noConflict:function(){return e.JSON=r,o}});e.JSON={parse:o.parse,stringify:o.stringify}}else t(e,exports);n&&define(function(){return o})}(this),"undefined"!=typeof subiz_account_id&&subiz_account_id>0&&(window._sbzq||(window._sbzq=[["_setAccount",subiz_account_id]])),function(e,t,n){"use strict";function i(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!==n.exec(t)&&(e=parseFloat(RegExp.$1));

}return e}var r=!1,o=!1,a=i();if(a>-1&&10>a&&(r=!0),t.querySelector&&t.addEventListener||(r=!0),r)return void console.log("Subiz: Please upgrade your browser!");var s=e._.noConflict(),c={},u={},l={},f=[],d=t.title,p=null,_={},v={},g={},m=JSON3.noConflict();u.waiting_time=45,u.expire_store=6e5,u.time_visitor_offline=6e4,u.file_support=[],u.file_not_support=[],u.all_file=[],u.max_file=0,u.max_size=0,"undefined"!=typeof _sbz_is_new_window&&(u._sbz_is_new_window=!0),"undefined"!=typeof _sbz_is_new_window_pc&&(u._sbz_is_new_window_pc=!0),
c.session={};var h=function(e,t){return t()}(this,function(){var e=function(e){e=e||{};for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={constructor:e,newWindow:!0,stripPrefix:!0,twitter:!0,email:!0,urls:!0,className:"",matcherRegex:function(){var e=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,t=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;

return new RegExp(["(",/(^|[^\w])@(\w{1,15})/.source,")|(",/(?:[\-;:&=\+\$,\w\.]+@)/.source,e.source,t.source,")|((?:(?:",/(?:[A-Za-z]{3,9}:(?:\/\/)?)/.source,e.source,")|(?:(.?//)?",/(?:www\.)/.source,e.source,")|(?:(.?//)?",e.source,t.source,"))",/(?:[\-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|])?/.source,")"].join(""),"gi")}(),protocolRelativeRegex:/(.)?\/\//,htmlRegex:new RegExp(["<(/)?","("+/[0-9a-zA-Z:]+/.source+")","(?:\\s+",/[^\s\0"'>\/=\x01-\x1F\x7F]+/.source,"(?:\\s*=\\s*"+/(?:".*?"|'.*?'|[^'"=<>`\s]+)/.source+")?",")*\\s*>"].join(""),"g"),
urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,link:function(e){return this.processHtml(e)},processHtml:function(e){for(var t,n,i=this.htmlRegex,r=0,o=0,a=[];null!==(t=i.exec(e));){var s=t[0],c=t[2],u=!!t[1];n=e.substring(r,t.index),r=t.index+s.length,"a"===c?u?(o=Math.max(o-1,0),0===o&&a.push(n)):(o++,a.push(this.processTextNode(n))):a.push(0===o?this.processTextNode(n):n),a.push(s)}return r<e.length&&(e=this.processTextNode(e.substring(r)),a.push(e)),a.join("")},processTextNode:function(e){var t=this,n=this.twitter,i=this.email,r=this.urls;

return e.replace(this.matcherRegex,function(e,o,a,s,c,u,l,f){var d=l||f;if(f=l="",o&&!n||c&&!i||u&&!r||u&&-1===u.indexOf(".")||u&&/^[A-Za-z]{3,9}:/.test(u)&&!/:.*?[A-Za-z]/.test(u)||d&&/^[\w]\/\//.test(d))return e;if(")"===e.charAt(e.length-1)){u=e.match(/\(/g);var p=e.match(/\)/g);(u&&u.length||0)<(p&&p.length||0)&&(e=e.substr(0,e.length-1),f=")")}return u=e,o?(o="twitter",l=a,u="https://twitter.com/"+s,e="@"+s):c?(o="email",u="mailto:"+c,e=c):(o="url",d?(a=new RegExp("^"+t.protocolRelativeRegex.source),
l=(d.match(a)[1]||"")+l,u=u.replace(a,"//"),e=e.replace(a,"")):/^[A-Za-z]{3,9}:/i.test(u)||(u="http://"+u)),a=t.createAnchorTag(o,u,e),l+a+f})},createAnchorTag:function(e,t,n){return e=this.createAnchorAttrsStr(e,t),n=this.processAnchorText(n),"<a "+e+">"+n+"</a>"},createAnchorAttrsStr:function(e,t){var n=['href="'+t+'"'],i=this.createCssClass(e);return i&&n.push('class="'+i+'"'),this.newWindow&&n.push('target="_blank"'),n.join(" ")},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:"";

},processAnchorText:function(e){return this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e),e=this.doTruncate(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e},doTruncate:function(e){var t=this.truncate;return t&&e.length>t&&(e=e.substring(0,t-2)+".."),e}},e.link=function(t,n){return new e(n).link(t)},e}),b=function(){var t,n,i={};return n=e.navigator.userAgent.toLowerCase(),
i.ios=function(){return i.iphone()||i.ipod()||i.ipad()},i.iphone=function(){return t("iphone")},i.ipod=function(){return t("ipod")},i.ipad=function(){return t("ipad")},i.android=function(){return t("android")},i.androidPhone=function(){return i.android()&&t("mobile")},i.androidTablet=function(){return i.android()&&!t("mobile")},i.blackberry=function(){return t("blackberry")||t("bb10")||t("rim")},i.blackberryPhone=function(){return i.blackberry()&&!t("tablet")},i.blackberryTablet=function(){return i.blackberry()&&t("tablet");

},i.windows=function(){return t("windows")},i.windowsPhone=function(){return i.windows()&&t("phone")},i.windowsTablet=function(){return i.windows()&&t("touch")},i.fxos=function(){return(t("(mobile;")||t("(tablet;"))&&t("; rv:")},i.fxosPhone=function(){return i.fxos()&&t("mobile")},i.fxosTablet=function(){return i.fxos()&&t("tablet")},i.meego=function(){return t("meego")},i.mobile=function(){return i.androidPhone()||i.iphone()||i.ipod()||i.windowsPhone()||i.blackberryPhone()||i.fxosPhone()||i.meego();

},i.tablet=function(){return i.ipad()||i.androidTablet()||i.blackberryTablet()||i.windowsTablet()||i.fxosTablet()},i.portrait=function(){return 90!==Math.abs(e.orientation)},i.landscape=function(){return 90===Math.abs(e.orientation)},i.detect=function(){return i.ios()?i.ipad()?"tablet":i.iphone()||i.ipod()?"mobile":void 0:i.android()?i.androidTablet()?"tablet":"mobile":i.blackberry()?i.blackberryTablet()?"tablet":"mobile":i.windows()?i.windowsTablet()?"tablet":i.windowsPhone()?"mobile":"desktop":i.fxos()?i.fxosTablet()?"tablet":"mobile":i.meego()?"mobile":"desktop";

},t=function(e){return-1!==n.indexOf(e)},i}(),y=function(e,t){for(;e.tagName.toLowerCase()!=t;)if(e=e.parentNode,!e)return null;return e},w=t.documentElement,x=/^[^{]+\{\s*\[native \w/,k=x.test(w.compareDocumentPosition),z=k||x.test(w.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;
return!1},E=function(e){return"none"===D.get(e,"display")||!z(e.ownerDocument,e)},T=function(e,t,n){var i=t.documentElement,r=/(^\n+)|(\n+$)/g,o=/^(?:\{.*\}|\[.*\])$/,a=/-([a-z])/gi,c=/\r\n/g,u=/[\-\+0-9\.]/gi,l=/\s+/,f=/\?/,d=/opacity=([^)]*)/,p=/^[\],:{}\s]*$/,_=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,v=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,g=/(?:^|:|,)(?:\s*\[)+/g,h="height margin-top margin-bottom padding-top padding-bottom".split(" "),b={},y={},w=[],x=function(){S(w,function(e,t){
t()}),t.removeEventListener("DOMContentLoaded",x,!1)},k=function(e,n){var i=typeof n;if("string"===i){var r=e&&e.ownerDocument||t,o=r.createDocumentFragment(),a=I("div");for(a.innerHTML=n;null!=a.childNodes[0];)o.appendChild(a.childNodes[0]);n=o,a=null}return"number"===i&&(n+=""),n},z=function(e,t){if(null!==e){if(t===n)return e;var i=0,r=e.length;if(r!==n&&r>0){for(;r>i&&t.call(e[i],e[i],e[i++])!==!1;);return e}return t.call(e,e)}},E=function(e,n,i,r){return z(e,function(e){var o,a,s={},c="show"===n,u=e.style,l=e._display;

l||(l=P.get(e,"display"),("none"===l||"inherit"===l)&&(o=H(t.body,I(e.nodeName)),l=P.get(o,"display"),U(o)),e._display=l),c?u.display=l:l="none",i?(a=P.get(e,"overflow"),u.overflow="hidden",s.opacity=c?{from:0,to:1}:{from:1,to:0},S(h,function(t,n){s[n]=c?{from:0,to:P.get(e,n)}:0}),Z(e,s,i,function(){S(h,function(t,n){D.set(e,n,"")}),u.filter=u.opacity=u.overflow="",u.display=l,r&&r.call(e)})):u.display=l})},T=function(e,t){if("object"==typeof t){var n=[];return S(t,function(t,i){n.push("object"==typeof i?T(e+"["+t+"]",i):e+"["+Q(t)+"]="+Q(i));

}),n.join("&")}return Q(e)+"="+Q(t)},j=t.removeEventListener?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)},N={$:function(e,t){return e.getElementById(t)},$each:function(e,t){if("undefined"!=typeof s)return s.each(e,function(e,n){t(n,e)}),e;var n,i=0,r=e.length,o=typeof e,a="object"===o;if(a&&r-1 in e)for(;r>i&&t.call(e[i],i,e[i++])!==!1;);else if(a)for(n in e)t.call(e[n],n,e[n]);else t.call(e,0,e);return e},$id:function(e,t,n){var i,r=[];return S(t instanceof Array?t:t.split(" "),function(t,n){
i=C(e,n),null!==i&&r.push(i)}),n?z(r,n):r},$dom:function(e,t){return t&&(e.length?z(e,t):t(e)),e},$tag:function(e,t,n){var i=[],r=e.getElementsByTagName(t),o=r.length,a=0;if(o>0){for(;o>a;a++)i.push(r[a]);return n?z(i,n):i}return i},$class:t.getElementsByClassName?function(e,t,n){var i=[],r=e.getElementsByClassName(t),o=r.length,a=0;if(o>0){for(;o>a;a++)i.push(r[a]);return n?z(i,n):i}return i}:function(e,t,n){var i=[],r=new RegExp("(^|\\s)"+t+"(\\s|$)");return O(e,"*",function(e){r.test(e.className)&&i.push(e);

}),n?z(i,n):i},$select:t.querySelectorAll?function(e,t,n){return n?z(e.querySelectorAll(t),n):e.querySelectorAll(t)}:function(e,t,n){var i=N.Qselector.styleSheet,r=[];return i.addRule(t,"q:a"),O(e,"*",function(e){"a"===e.currentStyle.q&&r.push(e)}),i.cssText="",n?z(r,n):r},$new:function(e,n){var i=t.createElement(e);if(n)try{return S(n,function(e,t){switch(e){case"css":case"style":D.set(i,t);break;case"innerHTML":case"html":B(i,t);break;case"className":case"class":J.set(i,t);break;case"text":X(i,t);

break;default:$.set(i,e,t)}}),i}catch(r){}finally{i=null}return i},$string:{camelCase:function(e){return e.replace("-ms-","ms-").replace(a,function(e,t){return(t+"").toUpperCase()})},replace:function(e,t){for(var n in t)e=e.replace(new RegExp(n,"ig"),t[n]);return e},slashes:function(e){return L.replace(e,{"\\\\":"\\\\","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r",'"':'\\"'})},trim:"".trim?function(e){return e.trim()}:function(e){return(e+"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}},$attr:{get:function(e,t){
return e.getAttribute(t)},set:function(e,t,n){return z(e,function(e){e.setAttribute(t,n)})},remove:function(e,t){return z(e,function(e){e.removeAttribute(t)})}},$data:{get:function(e,t){var n=$.get(e,"data-"+t);return"true"===n?!0:"false"===n?!1:"null"===n?"":null===n?"":""===n?"":!isNaN(parseFloat(n))&&isFinite(n)?+n:o.test(n)?Y.decode(n):n},set:function(e,t,n){return z(e,function(e){return n="object"==typeof n?Y.encode(n):n,"object"==typeof t?S(t,function(t,n){$.set(e,"data-"+t,n)}):$.set(e,"data-"+t,n),
e})},remove:function(e,t){return z(e,function(e){$.remove(e,"data-"+t)})}},$storage:e.localStorage?{set:function(e,t){localStorage[e]="object"==typeof t?Y.encode(t):t},get:function(e){var t=localStorage[e];return Y.isJSON(t)?Y.decode(t):t||""},remove:function(e){return localStorage.removeItem(e),!0}}:{set:function(e,t){t="object"==typeof t?Y.encode(t):t,R.set(N.storage,e,t),N.storage.save("Qstorage")},get:function(e){return N.storage.load("Qstorage"),R.get(N.storage,e)||""},remove:function(e){return N.storage.load("Qstorage"),
R.remove(N.storage,e),!0}},$event:{guid:0,global:{},handler:{call:function(e,t,n,i){var r=q.handler;n.currentTarget=t,(i===!1||i.call(t,n)===!1)&&(r.stopPropagation.call(n),r.preventDefault.call(n))},preventDefault:function(){var e=this.originalEvent;e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.stopPropagation()},mouseenter:function(e){return function(t){var n=t.relatedTarget;

if(this!==n){for(;n&&n!==this;)n=n.parentNode;n!==this&&e.call(this,t)}}}},on:function(e,i,r,o,a){return z(e,function(e){if(3===e.nodeType||8===e.nodeType)return!1;if("object"==typeof i){"string"!=typeof r&&(o=o||r,r=n);for(type in i)q.on(e,type,r,o,i[type]);return this}null==o&&null==a?(a=r,o=r=n):null==a&&("string"==typeof r?(a=o,o=n):(a=o,o=r,r=n)),e.guid===n&&(q.guid++,e.guid=q.guid,q.global[q.guid]={});var s=e.guid,c=(r||"")+i,u=q.global[s][c];u||(q.global[s][c]={});var l=function(i){var s,c,u={},l="altKey bubbles button buttons cancelable relatedTarget clientX clientY ctrlKey fromElement offsetX offsetY pageX pageY screenX screenY shiftKey toElement timeStamp".split(" ");

if(S(l,function(e,t){i[t]!==n&&(u[t]=i[t])}),u.originalEvent=i,u.preventDefault=q.handler.preventDefault,u.stopPropagation=q.handler.stopPropagation,u.stopImmediatePropagation=q.handler.stopImmediatePropagation,u.delegateTarget=e,u.data=o,c=u.target=r?i.target||i.srcElement||t:e,u.which=i.which||i.charCode||i.keyCode,u.metaKey=i.metaKey||i.ctrlKey,r)for(s=r?r.replace(".",""):"";c!==e;c=c.parentNode){if(null===c||c===t.body)return!1;(c.tagName.toLowerCase()===r||J.has(c,s))&&q.handler.call(i,c,u,a);

}else q.handler.call(i,c,u,a)};return e.addEventListener?(("mouseenter"===i||"mouseleave"===i)&&(i="mouseenter"===i?"mouseover":"mouseout",l=q.handler.mouseenter(l)),e.addEventListener(i,l,"blur"===i||"focus"===i)):e.attachEvent("on"+i,l),q.global[s][c][a+""]=l,e})},off:function(e,t,n,i){if("object"==typeof t){for(type in t)q.off(e,type,t[type]);return this}null==i&&(i=n,n=null);var r=e.guid,o=(n||"")+t;fn_key=i+"",i?(j(e,t,q.global[r][o][fn_key]),delete q.global[r][o][fn_key]):(S(q.global[r][o],function(n,i){
j(e,t,i)}),delete q.global[r][o])}},$clear:function(e){return e&&(clearTimeout(e),clearInterval(e)),null},$ready:function(e){if("complete"===t.readyState)return setTimeout(e,1);if(t.addEventListener)return w.push(e),void t.addEventListener("DOMContentLoaded",x,!1);var n=function(){try{i.doScroll("left")}catch(t){return void setTimeout(n,1)}e()};n()},$css:{get:function(e,t){if("object"==typeof t){var n={};return S(t,function(t,i){n[i]=P.get(e,i)}),n}return P.get(e,t)},set:function(e,t,n){return z(e,function(e){
return"object"==typeof t?S(t,function(t,n){P.set(e,L.camelCase(t),D.fix(t,n))}):P.set(e,L.camelCase(t),D.fix(t,n)),e})},number:{fontWeight:!0,lineHeight:!0,opacity:!0,zIndex:!0},unit:function(e,t){if(D.number[e])return"";var n=(t+"").replace(u,"");return""===n?"px":n},fix:function(e,t){return"number"!=typeof t||D.number[e]||(t+="px"),null===t&&isNaN(t)?!1:t}},$style:{get:e.getComputedStyle?function(e,n){if(null!==e){var i=t.defaultView.getComputedStyle(e,null).getPropertyValue(n);return"auto"===i||""===i?0:i;

}return!1}:function(e,t){if(null!==e){var n="opacity"===t?d.test(e.currentStyle.filter)?.01*parseFloat(RegExp.$1)+"":1:e.currentStyle[L.camelCase(t)];return"auto"===n?0:n}return!1},set:i.style.opacity!==n?function(e,t,n){return z(e,function(e){return e.style[t]=n,!0})}:function(e,t,n){return z(e,function(e){return e.currentStyle&&e.currentStyle.hasLayout||(e.style.zoom=1),"opacity"===t?(e.style.filter="alpha(opacity="+100*n+")",e.style.zoom=1):e.style[t]=n,!0})}},$pos:function(e,t,n){return z(e,function(e){
return P.set(e,"left",t+"px"),P.set(e,"top",n+"px"),e})},$offset:function(n){var r=t.body,o=n.getBoundingClientRect();return{top:o.top+(e.scrollY||r.parentNode.scrollTop||n.scrollTop)-(i.clientTop||r.clientTop||0),left:o.left+(e.scrollX||r.parentNode.scrollLeft||n.scrollLeft)-(i.clientLeft||r.clientLeft||0),width:n.offsetWidth,height:n.offsetHeight}},$append:function(e,t){return z(e,function(e){return e.appendChild(k(e,t))})},$prepend:function(e,t){return z(e,function(e){return e.firstChild?e.insertBefore(k(e,t),e.firstChild):e.appendChild(k(e,t));

})},$before:function(e,t){return z(e,function(e){return e.parentNode.insertBefore(k(e,t),e)})},$after:function(e,t){return z(e,function(e){return e.nextSibling?e.parentNode.insertBefore(k(e,t),e.nextSibling):e.parentNode.appendChild(k(e,t))})},$remove:function(e){return z(e,function(e){return F(e),e.guid!==n&&delete q.global[e.guid],null!==e&&e.parentNode?e.parentNode.removeChild(e):e})},$empty:function(e){return z(e,function(e){for(;e.firstChild;)1===e.nodeType&&e.guid!==n&&delete q.global[e.guid],
e.removeChild(e.firstChild);return e})},$html:function(e,t){return z(e,function(e){if(t){try{e.innerHTML=t}catch(n){H(F(e),t)}return e}return 1===e.nodeType?e.innerHTML:null})},$text:function(e,n){return z(e,function(e){if(n)return F(e),e.appendChild(t.createTextNode(n)),e;var i,o="",a=e.textContent;if((a||e.innerText)===e.innerHTML)o=a?L.trim(e.textContent.replace(r,"")):e.innerText.replace(c,"");else for(e=e.firstChild;e;e=e.nextSibling)i=e.nodeType,3===i&&""!==L.trim(e.nodeValue)&&(o+=e.nodeValue.replace(r,"")+(e.nextSibling&&e.nextSibling.tagName&&"br"!==e.nextSibling.tagName.toLowerCase()?"\n":"")),
(1===i||2===i)&&(o+=X(e)+("block"===P.get(e,"display")||"br"===e.tagName.toLowerCase()?"\n":""));return o})},$className:{add:function(e,t){return z(e,function(e){if(""===e.className)e.className=t;else{var n=e.className,i=[];S(t.split(l),function(e,t){new RegExp("\\b("+t+")\\b").test(n)||i.push(" "+t)}),e.className+=i.join("")}return e})},set:function(e,t){return z(e,function(e){return e.className=t,e})},has:function(e,t){return new RegExp("\\b("+t.split(l).join("|")+")\\b").test(e.className)},remove:function(e,t){
return z(e,function(e){return e.className=t?L.trim(e.className.replace(new RegExp("\\b("+t.split(l).join("|")+")\\b"),"").split(l).join(" ")):"",e})}},$hide:function(e,t,n){E(e,"hide",t,n)},$show:function(e,t,n){E(e,"show",t,n)},$toggle:function(e,t,n){return z(e,function(e){"none"===P.get(e,"display")?G(e,t,n):W(e,t,n)})},$animate:function(){var e=i.style;return e.webkitTransition!==n||e.MozTransition!==n||e.OTransition!==n||e.msTransition!==n||e.transition!==n}()?function(){var e=i.style,t=e.webkitTransition!==n?"Webkit":e.MozTransition!==n?"Moz":e.OTransition!==n?"O":e.msTransition!==n?"ms":"",r=t+"Transition";

return function(e,t,i,o){return z(e,function(e){var a,s=[],c=[],u=[],l=[],f=e.style;i=i||300;for(a in t)c[a]=L.camelCase(a),t[a].from!==n?(t[a].to=t[a].to||0,s[a]=D.number[a]?t[a].to:parseInt(t[a].to,10),u[a]=D.unit(a,t[a].to),P.set(e,c[a],parseInt(t[a].from,10)+u[a])):(s[a]=D.number[a]?t[a]:parseInt(t[a],10),u[a]=D.unit(a,t[a]),P.set(e,c[a],P.get(e,c[a]))),l.push(a);return setTimeout(function(){f[r]="all "+i+"ms",S(l,function(e,t){f[c[t]]=s[t]+u[t]})},15),setTimeout(function(){f[r]="",o&&o.call(e);

},i),e})}}():function(e,t,i,r){return z(e,function(e){var o,a,s,c=0,u=0,l=0,f=0,d=30,p=[],_=[],v=[],g=[],m=[];i=i||300;for(a in t)v.push(L.camelCase(a)),t[a].from!==n?(o=t[a].to,_.push(D.number[a]?t[a].from:parseInt(t[a].from,10)),P.set(e,v[u],_[u]+D.unit(a,o))):(o=t[a],_.push(parseInt(P.get(e,L.camelCase(a)),10))),p.push(D.number[a]?o:parseInt(o,10)),g.push(D.unit(a,o)),u++,f++;for(l=0;d>l;l++)for(m[l]=[],u=0;f>u;u++)m[l][v[u]]=_[u]+(p[u]-_[u])/d*l+("opacity"===v[u]?"":g[u]);for(;d>u;u++)s=setTimeout(function(){
for(u=0;f>u;u++)P.set(e,v[u],m[c][v[u]]);c++},i/d*u);return setTimeout(function(){for(u=0;f>u;u++)P.set(e,v[u],p[u]+g[u]);r&&r.call(e)},i),e})},$fadeout:function(e,t,n){return z(e,function(e){Z(e,{opacity:{from:1,to:0}},t||500,n)})},$fadein:function(e,t,n){return z(e,function(e){Z(e,{opacity:{from:0,to:1}},t||500,n)})},$cookie:{get:function(e){for(var n,i,r=t.cookie.split("; "),o=0,a=r.length;a>o;o++)if(n=r[o].split("="),n[0]===e)return i=decodeURIComponent(n[1]),Y.isJSON(i)?Y.decode(i):i+"";return null;

},set:function(e,n,i){if("object"==typeof e)return i=n,S(e,function(e,t){V.set(e,t,i)});var r=new Date;return r.setTime(r.getTime()),i=i?";expires="+new Date(r.getTime()+864e5*i).toGMTString():"",n="object"==typeof n?Y.encode(n):n,t.cookie=e+"="+Q(n)+i+";path=/"},remove:function(){return S(arguments,function(e,t){V.set(t,"",-1)}),!0}},$json:{decode:e.JSON3?function(e){return Y.isJSON(e)?m.parse(L.trim(e)):!1}:function(e){return Y.isJSON(e)?new Function("return "+L.trim(e))():!1},encode:e.JSON3?function(e){
return m.stringify(e)}:function(e){function t(e){var t,n,i,r,o=[];for(t in e){if(i=e[t],n=typeof i,"undefined"===n)return;if("function"!==n){switch(n){case"object":r=null===i?i:i.getDay?'"'+(1e3-10*~i.getUTCMonth()+i.toUTCString()+1e3+i/1).replace(/1(..).*?(\d\d)\D+(\d+).(\S+).*(...)/,"$3-$1-$2T$4.$5Z")+'"':i.length?"["+function(){var e=[];return S(i,function(t,n){e.push("string"==typeof n?'"'+L.slashes(n)+'"':n)}),e.join(",")}()+"]":Y.encode(i);break;case"number":r=isFinite(i)?i:null;break;case"boolean":
case"null":r=i;break;case"string":r='"'+L.slashes(i)+'"'}o.push('"'+t+'":'+r)}}return o.join(",")}return"{"+t(e)+"}"},isJSON:function(e){return"string"==typeof e&&""!==L.trim(e)?p.test(e.replace(_,"@").replace(v,"]").replace(g,"")):!1}},$ajax:function(e,t){"object"==typeof e&&(t=e,e=n),t=t||{};var i,r=new XMLHttpRequest,e=e||t.url,o=[];if(t.data&&S(t.data,function(e,t){o.push(T(e,t))}),i=o.join("&").replace(/%20/g,"+"),"GET"===t.type)r.open("GET",e+(f.test(e)?"&":"?")+i,!0),i=null;else{try{r.withCredentials=!0;

}catch(a){}r.open(t.type||"POST",e,!0)}r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.header&&S(t.header,function(e,t){r.setRequestHeader(e,t)}),r.send(i),r.onreadystatechange=function(){4===r.readyState&&(200===r.status&&t.success?(i=r.responseText,t.success(""!==i&&Y.isJSON(i)?Y.decode(i):i)):t.error&&t.error(r.status))}},$require:function(e,n){var r,o=[];S(e,function(e,a){b[a]||(b[a]=!0,o.push(a),r=/\.css[^\.]*$/gi.test(a)?I("link",{type:"text/css",rel:"stylesheet",
href:a}):I("script",{type:"text/javascript",async:!0,src:a}),r.onload=r.onreadystatechange=function(e){("load"===e.type||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,o.splice(o.indexOf(a),1),0===o.length&&n&&n())},H(t.head||O(t,"head")[0]||i,r))})},$template:function(e,t){var n=y[e];return n||(n="var s='';s+='"+e.replace(/[\r\t\n]/g," ").split("'").join("\\'").replace(/\{\{#([\w]*)\}\}(.*)\{\{\/(\1)\}\}/gi,function(e,t,n){return"';var i=0,l=data."+t+".length,d=data."+t+";for(;i<l;i++){s+='"+n.replace(/\{\{(\.|this)\}\}/g,"'+d[i]+'").replace(/\{\{([\w]*)\}\}/g,"'+d[i].$1+'")+"'}s+='";

}).replace(/\{\{(.+?)\}\}/g,"'+data.$1+'")+"';return s;",y[e]=n),t?new Function("data",n)(t):new Function("data",n)},$url:function(e){return encodeURIComponent(e)},$rand:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},$browser:function(){for(var e=navigator.userAgent.toLowerCase(),t={},n="msie|firefox|opera|webkit|iPad|iPhone|android".split("|"),i=n.length,r=6;i--;)t[n[i]]=e.indexOf(n[i].toLowerCase())>-1;for(;12>r;r++)t["msie"+r]=e.indexOf("msie "+r)>-1;return t.is=function(t){return new RegExp(t,"ig").test(e);

},t}()};return N.$ready(function(){t.querySelectorAll||(N.Qselector=H(t.body,I("style"))),e.localStorage||(N.storage=H(t.body,I("link",{style:{behavior:"url(#default#userData)"}})))}),N}(e,t),C=T.$,S=T.$each,j=(T.$id,T.$dom),O=T.$tag,N=T.$class,A=T.$select,I=T.$new,L=T.$string,$=T.$attr,R=T.$data,M=T.$storage,q=T.$event,D=(T.$clear,T.$ready,T.$css),P=T.$style,H=(T.$pos,T.$offset,T.$append),U=(T.$prepend,T.$before,T.$after,T.$remove),F=T.$empty,B=T.$html,X=T.$text,J=T.$className,W=T.$hide,G=T.$show,Z=(T.$toggle,
T.$animate),V=(T.$fadeout,T.$fadein,T.$cookie),Y=T.$json,K=T.$ajax,Q=(T.$require,T.$template,T.$url),ee=(T.$rand,T.$browser,function(){var e=function(e){e=e||{},this.ns=e.ns||"__sbz",this.data=M.get(this.ns)||{};var t=this;s.each(t.data,function(e,n){e.e&&+new Date>e.e&&(delete t.data[n],M.set(t.ns,t.data))})};return e.prototype={set:function(e,t,n){this.data[e]={v:t,e:n?+new Date+n:0},M.set(this.ns,this.data)},get:function(e){this.data=M.get(this.ns)||{};var t=this.data[e]||"";return t?t.e&&+new Date>t.e?(delete this.data[e],
M.set(this.ns,this.data),null):t.v:null},remove:function(e){delete this.data[e],M.set(this.ns,this.data)},clear:function(){this.data={},M.set(this.ns,this.data)}},e}()),te=new ee;M.remove("sbz_triggers_state"),M.remove("sbz_notify_agent_busy"),M.remove("sbz_time_last_message"),M.remove("sbz_new_message"),M.remove("sbz_sound"),M.remove("sbz_bubble"),M.remove("sbz_time_start");var ne=function(){var n=t,i=e,r={},o=function(){};o.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),
e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===r.arrIndexOf(n,t)&&n.push(t)},o.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var n=this._listeners[e],i=r.arrIndexOf(n,t);return-1!==i?void(n.length>1?this._listeners[e]=n.slice(0,i).concat(n.slice(i+1)):delete this._listeners[e]):void 0}},o.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,n);

};var a=function(e,t){if(this.type=e,"undefined"!=typeof t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};a.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var s=function(e){var t=this;t._events=e||[],t._listeners={}};s.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var n=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,n),
e in t._listeners)for(var i=0;i<t._listeners[e].length;i++)t._listeners[e][i].apply(t,n)}},s.prototype.on=function(e,t){var n=this;n._verifyType(e),n._nuked||(e in n._listeners||(n._listeners[e]=[]),n._listeners[e].push(t))},s.prototype._verifyType=function(e){var t=this;-1===r.arrIndexOf(t._events,e)&&r.log("Event "+m.stringify(e)+" not listed "+m.stringify(t._events)+" in "+t)},s.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={};

};var c="abcdefghijklmnopqrstuvwxyz0123456789_";r.random_string=function(e,t){t=t||c.length;var n,i=[];for(n=0;e>n;n++)i.push(c.substr(Math.floor(Math.random()*t),1));return i.join("")},r.random_number=function(e){return Math.floor(Math.random()*e)},r.random_number_string=function(e){var t=(""+(e-1)).length,n=Array(t+1).join("0");return(n+r.random_number(e)).slice(-t)},r.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},r.isSameOriginUrl=function(e,t){return t||(t=i.location.href),
e.split("/").slice(0,3).join("/")===t.split("/").slice(0,3).join("/")},r.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")},r.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var u="_jp";r.polluteGlobalNamespace=function(){u in i||(i[u]={})},r.closeFrame=function(e,t){return"c"+m.stringify([e,t])},r.userSetCode=function(e){return 1e3===e||e>=3e3&&4999>=e;

},r.countRTO=function(e){var t;return t=e>100?3*e:e+200},r.log=function(){i.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},r.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},r.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},r.amendUrl=function(e){var t=n.location;if(!e)throw new Error("Wrong url for SockJS");if(!r.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=t.protocol+e),
0===e.indexOf("/")&&(e=t.protocol+"//"+t.host+e),e=e.replace(/[/]+$/,"")},r.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},r.arrSkip=function(e,t){var n=r.arrIndexOf(e,t);if(-1===n)return e.slice();var i=e.slice(0,n);return i.concat(e.slice(n+1))},r.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},r.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var l,f=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,d=m.stringify,p=function(e){
var t,n={},i=[];for(t=0;65536>t;t++)i.push(String.fromCharCode(t));return e.lastIndex=0,i.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};r.quote=function(e){var t=d(e);return f.lastIndex=0,f.test(t)?(l||(l=p(f)),t.replace(f,function(e){return l[e]})):t};var _=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){
for(var e={},t=0;t<_.length;t++){var n=_[t];e[n]=E[n]&&E[n].enabled()}return e},r.detectProtocols=function(e,t,n){var i={},r=[];t||(t=_);for(var o=0;o<t.length;o++){var a=t[o];i[a]=e[a]}var s=function(e){var t=e.shift();i[t]?r.push(t):e.length>0&&s(e)};return n.websocket!==!1&&s(["websocket"]),i["xhr-streaming"]&&!n.null_origin?r.push("xhr-streaming"):!i["xdr-streaming"]||n.cookie_needed||n.null_origin?s(["iframe-eventsource","iframe-htmlfile"]):r.push("xdr-streaming"),i["xhr-polling"]&&!n.null_origin?r.push("xhr-polling"):!i["xdr-polling"]||n.cookie_needed||n.null_origin?s(["iframe-xhr-polling","jsonp-polling"]):r.push("xdr-polling"),
r};var v="_sockjs_global";r.createHook=function(){var e="a"+r.random_string(8);if(!(v in i)){var t={};i[v]=function(e){return e in t||(t[e]={id:e,del:function(){delete t[e]}}),t[e]}}return i[v](e)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(e,t){"undefined"!=typeof i.addEventListener?i.addEventListener(e,t,!1):(n.attachEvent("on"+e,t),i.attachEvent("on"+e,t))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(e,t){"undefined"!=typeof i.addEventListener?i.removeEventListener(e,t,!1):(n.detachEvent("on"+e,t),
i.detachEvent("on"+e,t))};var g={},h=!1,b=function(){for(var e in g)g[e](),delete g[e]},y=function(){h||(h=!0,b())};r.attachEvent("unload",y),r.unload_add=function(e){var t=r.random_string(8);return g[t]=e,h&&r.delay(b),t},r.unload_del=function(e){e in g&&delete g[e]},r.createIframe=function(e,t){var i,o,a=n.createElement("iframe"),s=function(){clearTimeout(i);try{a.onload=null}catch(e){}a.onerror=null},c=function(){a&&(s(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),r.unload_del(o));

},u=function(e){a&&(c(),t(e))},l=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(n){}};return a.src=e,a.style.display="none",a.style.position="absolute",a.onerror=function(){u("onerror")},a.onload=function(){clearTimeout(i),i=setTimeout(function(){u("onload timeout")},2e3)},n.body.appendChild(a),i=setTimeout(function(){u("timeout")},15e3),o=r.unload_add(c),{post:l,cleanup:c,loaded:s}},r.createHtmlfile=function(e,n){var o,a,s,c=new ActiveXObject("htmlfile"),l=function(){
clearTimeout(o)},f=function(){c&&(l(),r.unload_del(a),s.parentNode.removeChild(s),s=c=null,CollectGarbage())},d=function(e){c&&(f(),n(e))},p=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(n){}};c.open(),c.write('<html><script>document.domain="'+t.domain+'";</script></html>'),c.close(),c.parentWindow[u]=i[u];var _=c.createElement("div");return c.body.appendChild(_),s=c.createElement("iframe"),_.appendChild(s),s.src=e,o=setTimeout(function(){d("timeout")},15e3),a=r.unload_add(f),
{post:p,cleanup:f,loaded:l}};var w=function(){};w.prototype=new s(["chunk","finish"]),w.prototype._start=function(e,t,n,o){var a=this;try{a.xhr=new XMLHttpRequest}catch(s){}if(!a.xhr)try{a.xhr=new i.ActiveXObject("Microsoft.XMLHTTP")}catch(s){}(i.ActiveXObject||i.XDomainRequest)&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=r.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,t,!0)}catch(c){return a.emit("finish",0,""),void a._cleanup()}if(o&&o.no_credentials||(a.xhr.withCredentials="true"),
o&&o.headers)for(var u in o.headers)a.xhr.setRequestHeader(u,o.headers[u]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}1223===t&&(t=204),n&&n.length>0&&a.emit("chunk",t,n);break;case 4:var t=e.status;1223===t&&(t=204),a.emit("finish",t,e.responseText),a._cleanup(!1)}}},a.xhr.send(n)},w.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{
t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},w.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var x=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};x.prototype=new w;var k=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};k.prototype=new w;var z=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};z.prototype=new s(["chunk","finish"]),z.prototype._start=function(e,t,n){
var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var a=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(s){a()}},z.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,
e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},z.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return i.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:i.XDomainRequest&&n.domain?2:q.enabled()?3:4};var E=function(e,t,n){if(this===i)return new E(e,t,n);var o,a=this;a._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},n&&r.objectExtend(a._options,n),a._base_url=r.amendUrl(e),a._server=a._options.server||r.random_number_string(1e3),
a._options.protocols_whitelist&&a._options.protocols_whitelist.length?o=a._options.protocols_whitelist:(o="string"==typeof t&&t.length>0?[t]:r.isArray(t)?t:null,o&&a._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),a._protocols=[],a.protocol=null,a.readyState=E.CONNECTING,a._ir=X(a._base_url),a._ir.onfinish=function(e,t){a._ir=null,e?(a._options.info&&(e=r.objectExtend(e,a._options.info)),a._options.rtt&&(t=a._options.rtt),
a._applyInfo(e,t,o),a._didClose()):a._didClose(1002,"Can't connect to server",!0)}};E.prototype=new o,E.version="0.3.4",E.CONNECTING=0,E.OPEN=1,E.CLOSING=2,E.CLOSED=3,E.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},E.prototype._dispatchOpen=function(){var e=this;e.readyState===E.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=E.OPEN,e.dispatchEvent(new a("open"))):e._didClose(1006,"Server lost session")},E.prototype._dispatchMessage=function(e){
var t=this;t.readyState===E.OPEN&&t.dispatchEvent(new a("message",{data:e}))},E.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===E.OPEN&&t.dispatchEvent(new a("heartbeat",{}))},E.prototype._didClose=function(e,t,n){var i=this;if(i.readyState!==E.CONNECTING&&i.readyState!==E.OPEN&&i.readyState!==E.CLOSING)throw new Error("INVALID_STATE_ERR");i._ir&&(i._ir.nuke(),i._ir=null),i._transport&&(i._transport.doCleanup(),i._transport=null);var o=new a("close",{code:e,reason:t,wasClean:r.userSetCode(e)
});if(!r.userSetCode(e)&&i.readyState===E.CONNECTING&&!n){if(i._try_next_protocol(o))return;o=new a("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:o})}i.readyState=E.CLOSED,r.delay(function(){i.dispatchEvent(o)})},E.prototype._didMessage=function(e){var t=this,n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":for(var i=m.parse(e.slice(1)||"[]"),r=0;r<i.length;r++)t._dispatchMessage(i[r]);break;case"m":var i=m.parse(e.slice(1)||"null");t._dispatchMessage(i);
break;case"c":var i=m.parse(e.slice(1)||"[]");t._didClose(i[0],i[1]);break;case"h":t._dispatchHeartbeat()}},E.prototype._try_next_protocol=function(e){var t=this;for(t.protocol&&(t._debug("Closed transport:",t.protocol,""+e),t.protocol=null),t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null);;){var i=t.protocol=t._protocols.shift();if(!i)return!1;if(E[i]&&E[i].need_body===!0&&(!n.body||"undefined"!=typeof n.readyState&&"complete"!==n.readyState))return t._protocols.unshift(i),
t.protocol="waiting-for-load",r.attachEvent("load",function(){t._try_next_protocol()}),!0;if(E[i]&&E[i].enabled(t._options)){var o=E[i].roundTrips||1,a=(t._options.rto||0)*o||5e3;t._transport_tref=r.delay(a,function(){t.readyState===E.CONNECTING&&t._didClose(2007,"Transport timeouted")});var s=r.random_string(8),c=t._base_url+"/"+t._server+"/"+s;return t._debug("Opening transport:",i," url:"+c," RTO:"+t._options.rto),t._transport=new E[i](t,c,t._base_url),!0}t._debug("Skipping transport:",i)}},E.prototype.close=function(e,t){
var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==E.CONNECTING&&n.readyState!==E.OPEN?!1:(n.readyState=E.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},E.prototype.send=function(e){var t=this;if(t.readyState===E.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===E.OPEN&&t._transport.doSend(r.quote(""+e)),!0},E.prototype._applyInfo=function(e,t,i){var o=this;o._options.info=e,o._options.rtt=t,o._options.rto=r.countRTO(t),o._options.info.null_origin=!n.domain;

var a=r.probeProtocols();o._protocols=r.detectProtocols(a,i,e)};var T=E.websocket=function(e,t){var n=this,o=t+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),n.ri=e,n.url=o;var a=i.WebSocket||i.MozWebSocket;n.ws=new a(n.url),n.ws.onmessage=function(e){n.ri._didMessage(e.data)},n.unload_ref=r.unload_add(function(){n.ws.close()}),n.ws.onclose=function(){n.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};T.prototype.doSend=function(e){this.ws.send("["+e+"]");

},T.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},T.enabled=function(){return!(!i.WebSocket&&!i.MozWebSocket)},T.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},C.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){
t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,n){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+n):e.send_schedule_wait()}),e.send_buffer=[]}},C.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var S=function(e,t,i){var o=this;if(!("_send_form"in o)){
var a=o._send_form=n.createElement("form"),s=o._send_area=n.createElement("textarea");s.name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(s),n.body.appendChild(a)}var a=o._send_form,s=o._send_area,c="a"+r.random_string(8);a.target=c,a.action=e+"/jsonp_send?i="+c;var u;try{u=n.createElement('<iframe name="'+c+'">')}catch(l){u=n.createElement("iframe"),u.name=c}u.id=c,a.appendChild(u),u.style.display="none";

try{s.value=t}catch(f){r.log("Your browser is seriously broken. Go home! "+f.message)}a.submit();var d=function(e){u.onerror&&(u.onreadystatechange=u.onerror=u.onload=null,r.delay(500,function(){u.parentNode.removeChild(u),u=null}),s.value="",i(!0))};return u.onerror=u.onload=d,u.onreadystatechange=function(e){"complete"==u.readyState&&d()},d},j=function(e){return function(t,n,i){var r=new e("POST",t+"/xhr_send",n);return r.onfinish=function(e,t){i(200===e||204===e,"http status "+e)},function(e){
i(!1,e)}}},O=function(e,t){var i,o,a=n.createElement("script"),s=function(e){o&&(o.parentNode.removeChild(o),o=null),a&&(clearTimeout(i),a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,a=null,t(e),t=null)},c=!1,u=null;if(a.id="a"+r.random_string(8),a.src=e,a.type="text/javascript",a.charset="UTF-8",a.onerror=function(e){u||(u=setTimeout(function(){c||s(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},a.onload=function(e){s(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"));

},a.onreadystatechange=function(e){if(/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){c=!0;try{a.onclick()}catch(t){}}a&&s(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof a.async&&n.attachEvent)if(/opera/i.test(navigator.userAgent))o=n.createElement("script"),o.text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=o.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch(l){}a.async=!0}"undefined"!=typeof a.async&&(a.async=!0),
i=setTimeout(function(){s(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var f=n.getElementsByTagName("head")[0];return f.insertBefore(a,f.firstChild),o&&f.insertBefore(o,f.firstChild),s},N=E["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(S),n._schedule_recv()};N.prototype=new C,N.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv();

};e._recv_stop=A(e.trans_url+"/jsonp",O,t)},N.enabled=function(){return!0},N.need_body=!0,N.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var A=function(e,t,n){var o="a"+r.random_string(6),a=e+"?c="+escape(u+"."+o),s=0,c=function(e){switch(s){case 0:delete i[u][o],n(e);break;case 1:n(e),s=2;break;case 2:delete i[u][o]}},l=t(a,c);i[u][o]=l;var f=function(){i[u][o]&&(s=1,i[u][o](r.closeFrame(1e3,"JSONP user aborted read")));

};return f},I=function(){};I.prototype=new C,I.prototype.run=function(e,t,n,i,r){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(j(r)),o.poll=new Q(e,i,t+n,r)},I.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var L=E["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",re,r.XHRCorsObject)};L.prototype=new I,L.enabled=function(){return i.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},L.roundTrips=2,L.need_body=!0;

var $=E["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",re,r.XDRObject)};$.prototype=new I,$.enabled=function(){return!!i.XDomainRequest},$.roundTrips=2;var R=E["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",re,r.XHRCorsObject)};R.prototype=new I,R.enabled=L.enabled,R.roundTrips=2;var M=E["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",re,r.XDRObject)};M.prototype=new I,M.enabled=$.enabled,M.roundTrips=2;var q=function(){};q.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,
i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},q.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),
e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},q.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),i=e.data.slice(8,9),r=e.data.slice(9);if(n===t.window_id)switch(i){case"s":t.iframeObj.loaded(),t.postMessage("s",m.stringify([E.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(r)}}},q.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)},q.prototype.doSend=function(e){this.postMessage("m",e);

},q.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof i.postMessage||"object"==typeof i.postMessage)&&!e};var D,P=function(e,t){parent!==i?parent.postMessage(D+e+(t||""),"*"):r.log("Can't postMessage, no parent window.",e,t)},H=function(){};H.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},H.prototype._didMessage=function(e){P("t",e)},H.prototype._doSend=function(e){this._transport.doSend(e)},H.prototype._doCleanup=function(){
this._transport.doCleanup()},r.parent_origin=void 0,E.bootstrap_iframe=function(){var e;D=n.location.hash.slice(1);var t=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var n=t.data.slice(0,8),o=t.data.slice(8,9),a=t.data.slice(9);if(n===D)switch(o){case"s":var s=m.parse(a),c=s[0],u=s[1],l=s[2],f=s[3];if(c!==E.version&&r.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+E.version+'".'),!r.flatUrl(l)||!r.flatUrl(f))return void r.log("Only basic urls are supported in SockJS");

if(!r.isSameOriginUrl(l)||!r.isSameOriginUrl(f))return void r.log("Can't connect to different domain from within an iframe. ("+m.stringify([i.location.href,l,f])+")");e=new H,e._transport=new H[u](e,l,f);break;case"m":e._doSend(a);break;case"c":e&&e._doCleanup(),e=null}}};r.attachMessage(t),P("s")};var U=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};U.prototype=new s(["finish"]),U.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),a=r.delay(8e3,function(){
o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var r=(new Date).getTime()-i,o=m.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var F=function(e){var t=this,i=function(){var n=new q;n.protocol="w-iframe-info-receiver";var i=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var i=m.parse(e.substr(1)),r=i[0],o=i[1];t.emit("finish",r,o)}else t.emit("finish");n.doCleanup(),n=null},r={
_options:{},_didClose:i,_didMessage:i};n.i_constructor(r,e,e)};n.body?i():r.attachEvent("load",i)};F.prototype=new s(["finish"]);var B=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};B.prototype=new s(["finish"]);var X=function(e){if(r.isSameOriginUrl(e))return new U(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new U(e,r.XHRLocalObject);case 2:return new U(e,r.XDRObject);case 3:return new F(e);default:return new B}},J=H["w-iframe-info-receiver"]=function(e,t,n){
var i=new U(n,r.XHRLocalObject);i.onfinish=function(t,n){e._didMessage("m"+m.stringify([t,n])),e._didClose()}};J.prototype.doCleanup=function(){};var W=E["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};W.prototype=new q,W.enabled=function(){return"EventSource"in i&&q.enabled()},W.need_body=!0,W.roundTrips=3;var G=H["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",ee,r.XHRLocalObject)};G.prototype=new I;var Z=E["iframe-xhr-polling"]=function(){
var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};Z.prototype=new q,Z.enabled=function(){return i.XMLHttpRequest&&q.enabled()},Z.need_body=!0,Z.roundTrips=3;var V=H["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",re,r.XHRLocalObject)};V.prototype=new I;var Y=E["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Y.prototype=new q,Y.enabled=function(){return q.enabled()},Y.need_body=!0,Y.roundTrips=3;var K=H["w-iframe-htmlfile"]=function(e,t){
this.run(e,t,"/htmlfile",ie,r.XHRLocalObject)};K.prototype=new I;var Q=function(e,t,n,i){var r=this;r.ri=e,r.Receiver=t,r.recv_url=n,r.AjaxObject=i,r._scheduleRecv()};Q.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),n=0;t.onmessage=function(t){n+=1,e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===n.reason?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},Q.prototype.abort=function(){
var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var ee=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new a("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,i){var o=i?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new a("close",{reason:o}))})}};ee.prototype=new o,ee.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var te,ne=function(){
if(void 0===te)if("ActiveXObject"in i)try{te=!!new ActiveXObject("htmlfile")}catch(e){}else te=!1;return te},ie=function(e){var t=this;r.polluteGlobalNamespace(),t.id="a"+r.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(u+"."+t.id);var n,o=ne()?r.createHtmlfile:r.createIframe;i[u][t.id]={start:function(){n.loaded()},message:function(e){t.dispatchEvent(new a("message",{data:e}))},stop:function(){t.iframe_close({},"network")}},t.iframe_close=function(e,r){n.cleanup(),t.iframe_close=n=null,
delete i[u][t.id],t.dispatchEvent(new a("close",{reason:r}))},n=o(e,function(e){t.iframe_close({},"permanent")})};ie.prototype=new o,ie.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var re=function(e,t){var n=this,i=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(200===e)for(;;){var r=t.slice(i),o=r.indexOf("\n");if(-1===o)break;i+=o+1;var s=r.slice(0,o);n.dispatchEvent(new a("message",{data:s}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null;

var i=200===e?"network":"permanent";n.dispatchEvent(new a("close",{reason:i}))}};return re.prototype=new o,re.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new a("close",{reason:"user"})),e.xo=null)},E.getUtils=function(){return r},E.getIframeTransport=function(){return q},E}(),ie=function(){var t=function(t,n){this._events={},this._url=t||"//"+e.location.hostname,this._port=80,this._socket=null,this._namespace="",this.auto_reconnect=!0,this._options=n||{},this._delay=this.delay=500,
this.reconnecting=!1,this.connected=!1,this.timer={},this.moment={}};return t.prototype.on=function(e,t,n){var i=t;n&&(i=function(){t.apply(n,arguments)}),this._events[e]||(this._events[e]=[]),this._events[e].push(i)},t.prototype.emit=function(e){this._socket.send(m.stringify(e))},t.prototype.connect=function(){function e(e){var t=e.type?e.type:e.name,n=e.data,r=i._events[t];if(r)for(var o="object"==typeof n&&null!==n?n:m.parse(n),a=0,s=r.length;s>a;++a){var c=r[a];"function"==typeof c&&!function(e){
setTimeout(function(){e(o)},0)}(c)}}if(this._socket){var t=this.auto_reconnect;this.disconnect(),this.auto_reconnect=t}var n=new ne(this._url,null,this._options),i=this;n.onopen=function(){i.delay=i._delay,i.connected=!0,i.reconnecting&&(i.reconnecting=!1,i.moment.disconnect=null,e({name:"reconnect",data:{}})),i.timer.reconnect&&(clearTimeout(i.timer.reconnect),i.timer.reconnect=null),e({name:"open",data:{}}),e({name:"connect",data:{}})},n.onmessage=function(t){e(t)},n.onclose=function(t){if(e({name:"close",
data:t}),e({name:"disconnect",data:t}),i.connected=!1,"force_close"==t.reason)return i.reconnecting=!1,i.moment.disconnect=null,clearTimeout(i.timer.reconnect),void(i.timer.reconnect=null);if(i.moment.disconnect||(i.moment.disconnect=+new Date),i.auto_reconnect){var n=+new Date;n-i.moment.disconnect>6e4?(gt("reconnect timeout in 60s"),i.reconnecting=!1,i.moment.disconnect=null,clearTimeout(i.timer.reconnect),i.timer.reconnect=null,e({name:"reconnect_failed",data:{}})):(i.reconnecting=!0,gt("cb reconnect after "+i.delay+"ms"),
gt("disconnected in "+(n-i.moment.disconnect)+"ms"),i.timer.reconnect=setTimeout(function(){i.delay=i.delay>2e3?4e3:2*i.delay,i.connect()},i.delay))}},this._socket=n},t.prototype.reconnect=function(){var e=this;return e.connected?void gt("socket is connected : ignore call reconnect"):(e.auto_reconnect=!0,void e.connect())},t.prototype.disconnect=function(){this.auto_reconnect=!1,this._socket&&(this._socket.close(),this._socket=null)},t}(),re=function(){u.socket_connected||l.reconnect()},oe=function(e,t){
if(u.socket_connected)l.emit(t);else{var n={channel:e,data:t};f.push(n)}},ae=function(){if(f.length>0){var e=s.clone(f);f=[],s.each(e,function(e){l.emit(e.data)})}},se=function(){u.socket_connected&&l.disconnect()};"undefined"!=typeof _sbz_sid&&u._sbz_is_new_window&&(u.sbz_sid=_sbz_sid),"undefined"!=typeof _sbz_vid&&u._sbz_is_new_window&&(u.sbz_vid=_sbz_vid),"undefined"!=typeof _sbz_agent&&u._sbz_is_new_window_pc&&(u.sbz_agent=_sbz_agent),"undefined"!=typeof _sbz_wopen&&(u.wopen=_sbz_wopen);var ce="none",ue="2.1504221534",le="",fe=t.title,de=e.location.href,pe=function(e){
e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))};u._sbz_is_new_window&&(de=pe("url"),fe=pe("title"));var _e=function(){var e=V.get("__sbzbl");if("1"==e)return!1;var n=te.get("time_site")||vt();te.set("time_site",n,u.expire_store),te.set("time_page",vt(),u.expire_store),u.url_static=ft("http://static.subiz.com/"),u.url_socket=ft("https://sock-ha.subiz.com/widget"),u.url_sock_p="https://sock-p.subiz.com/",
u.url_dashboard=ft("http://css-dashboard.subiz.com/"),u.url_css=ft(u.url_dashboard+"widget/css/"+u.aid+"/subiz-widget-view.css"),u.url_new_window="https://m.widget.subiz.com/v1/widget/",u.url_upload="https://sock-p.subiz.com/ev/file_upload",u.url_file="https://s3.amazonaws.com/files.subiz.com";var i=b.detect()||"desktop";if(c._device=i,u._sbz_is_new_window&&"desktop"==c._device)return!1;"desktop"!=c._device&&(u.url_css=ft(u.url_dashboard+"widget/css/"+u.aid+"/subiz-widget-mobile.css")),u.url_avatar=ft(u.url_dashboard+"img/avatar-chat.png");

var r=ot(),o=at(),a=u.wopen;o&&(u._sbz_is_new_window||V.set("__sbzsid",o),u.sbz_sid=o),r&&o||te.set("is_init",1,1e4),u.url_base_data=u.url_sock_p+"a/"+u.aid+(r?"?vid="+r:""),u._sbz_is_new_window&&(u.url_base_data=u.url_sock_p+"a/"+u.aid+(r?"?vid="+r:"?vid=")+(o?"&sid="+o:"")+(a?"&wopen="+a:"")),u._sbz_is_new_window_pc&&(u.url_base_data=u.url_sock_p+"a/"+u.aid+"?vid="+(a?"&wopen="+a:""));var l=u.url_static+"views/widget.txt";K(l,{type:"GET",success:function(e){gt("cb get template");try{var t="Harry";

c.html=m.parse(wt(e,t)),c.html_ready=!0}catch(n){gt("Error parse json data"),gt(n),c.html={},c.html_ready=!1}},error:function(e){}}),K(u.url_css,{type:"GET",success:function(e){gt("css ready"),c.css=e.replace(/..\/..\/img\//g,u.url_dashboard+"widget/img/"),c.css_ready=!0},error:function(e){}}),K(u.url_base_data,{type:"GET",success:function(e){if(gt("cb get base data"),gt(e),e&&"error"==e.status)return gt("ERROR : get base data",e),void(_.io&&clearTimeout(_.io.id));if(!e||!e.status)return void gt("Error decode data");

if(e.is_deny)return gt("deny request"),V.set("__sbzbl","1"),void(_.base_ready&&_.base_ready.id&&clearTimeout(_.base_ready.id));gt("build base widget"),c.lang=e.widget.language.data,c.lang_name=e.widget.language.name,c.lang.online.title_compress||(c.lang.online.title_compress=c.lang.online.title,c.lang.offline.title_compress=c.lang.offline.title);var n=e.widget.survey,i=e.widget.offline_survey||{};if(n.name&&n.name.status||(i.name={status:"active",is_require:1},i.email={status:"active",is_require:1
},i.phone={status:i.phone||n.phone,is_require:1},i.department={status:n.department,is_require:1},n.name={status:"active",is_require:1},n.email={status:"active",is_require:1},n.phone={status:n.phone,is_require:1},n.question={status:n.question,is_require:1},n.department={status:n.department,is_require:1},e.widget.offline_survey=i),c.widget=e.widget,u.status_widget=e.status,u.status_account=e.status,u._status_account=e._status,u.position=e.position||"right",e.widget.avatar){var r=new RegExp("^http(s)?://","g");

u.url_avatar=r.test(e.widget.avatar)?ft(e.widget.avatar):u.url_dashboard+e.widget.avatar}Pe("init",{check:function(){return c.css_ready&&c.html_ready?!0:!1},success:function(){Pe("dom",{check:function(){return t.body?!0:!1},success:He})}})},error:function(e){}}),Pe("io",{check:function(){var e=ot(),t=at();return c.base_ready&&e&&t?!0:!1},success:qe});var f={aid:u.aid,vid:r,sid:o,url:de,title:fe,referer:t.referrer,__v:ue},d=u.url_sock_p+"ev/init";K(d,{data:f,success:function(e){return e&&"error"==e.status?(gt("ERROR : get full data",e),
void(_.io&&clearTimeout(_.io.id))):void(e&&s.size(e)>0&&s.each(e,function(e){De(e)}))},error:function(e){}});var p=V.get("__sbzer");p&&(le=!0)},ve=function(){var e=c.session,t=e.agents_rated||{},n=e.agent||e.last_agent||"";n&&!t[n]&&(t[n]="good",e.agents_rated=t,N(Tt,"rate-good",function(e){J.add(e,"rated")}),oe("cev",{ev:"rate",value:"good",time:vt()}))},ge=function(){var e=c.session,t=e.agents_rated||{},n=e.agent||e.last_agent||"";n&&!t[n]&&(t[n]="bad",e.agents_rated=t,N(Tt,"rate-bad",function(e){
J.add(e,"rated")}),oe("cev",{ev:"rate",value:"bad",time:vt()}))},me=function(){var e=c.visitor,t=e.name||"",n=e.email||"",i=e.phone||"",r=C(Ct,"v_department_offline").value,o=C(Ct,"v_message_offline").value,a=!0,s=c.widget.offline_survey||{};if("active"!=s.department.status||1!=s.department.is_require||r?(J.remove(C(Ct,"v_department_offline"),"form-error"),W(C(Ct,"error_department_offline"))):(a=!1,gt("valid","not derpatment"),J.add(C(Ct,"v_department_offline"),"form-error"),G(C(Ct,"error_department_offline"))),
o?J.remove(C(Ct,"v_message_offline"),"form-error"):(a=!1,gt("valid","not message"),J.add(C(Ct,"v_message_offline"),"form-error")),gt("valid offline",a),a){var l={ev:"message_offline",name:t,email:n,phone:i,department:r,message:o,url:de,time:vt()};if("offline"==u._status_account){var f=u.url_sock_p+"ev/message_offline";l.aid=u.aid,l.vid=ot(),l.sid=at(),gt("cev_data",l),K(f,{data:l,success:function(e){gt("success data send mail",e)},error:function(e){gt("error data send mail",e)}})}else gt("cev_data away",l),
oe("cev",l);vn(0),hn(1),C(Ct,"v_message_offline").value=""}else Dt("offline")},he=function(){var e=c.widget.offline_survey||{},t=C(Ct,"v_name_offline").value.trim(),n=C(Ct,"v_email_offline").value.trim(),i=C(Ct,"v_phone_offline").value.trim(),r=C(Ct,"v_department_offline_edit").value,o=C(Ct,"v_message_offline_edit").value.trim(),a=!0;if("active"!=e.name.status||1!=e.name.is_require||t?(J.remove(C(Ct,"v_name_offline"),"form-error"),W(C(Ct,"error_name_offline"))):(a=!1,J.add(C(Ct,"v_name_offline"),"form-error"),
G(C(Ct,"error_name_offline"))),"active"!=e.email.status||1!=e.email.is_require&&!n||xt(n)?(J.remove(C(Ct,"v_email_offline"),"form-error"),W(C(Ct,"error_email_offline"))):(a=!1,J.add(C(Ct,"v_email_offline"),"form-error"),G(C(Ct,"error_email_offline"))),"active"!=e.phone.status||1!=e.phone.is_require||i?(J.remove(C(Ct,"v_phone_offline"),"form-error"),W(C(Ct,"error_phone_offline"))):(a=!1,J.add(C(Ct,"v_phone_offline"),"form-error"),G(C(Ct,"error_phone_offline"))),"active"!=e.department.status||1!=e.department.is_require||r?(J.remove(C(Ct,"v_department_offline_edit"),"form-error"),
W(C(Ct,"error_department_edit_offline"))):(a=!1,J.add(C(Ct,"v_department_offline_edit"),"form-error"),G(C(Ct,"error_department_edit_offline"))),o?J.remove(C(Ct,"v_message_offline_edit"),"form-error"):(a=!1,J.add(C(Ct,"v_message_offline_edit"),"form-error")),gt("valid offline edit",a),a){var s={ev:"message_offline",name:t,email:n,phone:i,department:r,message:o,url:de,time:vt()};if("offline"==u._status_account){var l=u.url_sock_p+"ev/message_offline";s.aid=u.aid,s.vid=ot(),s.sid=at(),gt("cev_data",s),
K(l,{data:s,success:function(e){gt("success data send mail",e)},error:function(e){gt("error data send mail",e)}})}else gt("cev_data away",s),oe("cev",s);Ae("name",t),Ae("email",n),Ae("phone",i),gn(0),hn(1),C(Ct,"v_message_offline_edit").value=""}else Dt("offline")},be=function(){var e=c.widget.survey,t=C(Tt,"v_department_survey").value,n=C(Tt,"v_name_survey").value.trim(),i=C(Tt,"v_email_survey").value.trim(),r=C(Tt,"v_phone_survey").value.trim(),o=C(Tt,"v_question_survey").value.trim(),a=!0;if("active"!=e.department.status||1!=e.department.is_require||t?(J.remove(C(Tt,"v_department_survey"),"form-error"),
W(C(Tt,"error_department_survey"))):(a=!1,J.add(C(Tt,"v_department_survey"),"form-error"),G(C(Tt,"error_department_survey"))),"active"!=e.name.status||1!=e.name.is_require||n?(J.remove(C(Tt,"v_name_survey"),"form-error"),W(C(Tt,"error_name_survey"))):(a=!1,J.add(C(Tt,"v_name_survey"),"form-error"),G(C(Tt,"error_name_survey"))),"active"!=e.email.status||1!=e.email.is_require&&!i||xt(i)?(J.remove(C(Tt,"v_email_survey"),"form-error"),W(C(Tt,"error_email_survey"))):(a=!1,J.add(C(Tt,"v_email_survey"),"form-error"),
G(C(Tt,"error_email_survey"))),"active"!=e.phone.status||1!=e.phone.is_require||r?(J.remove(C(Tt,"v_phone_survey"),"form-error"),W(C(Tt,"error_phone_survey"))):(a=!1,J.add(C(Tt,"v_phone_survey"),"form-error"),G(C(Tt,"error_phone_survey"))),"active"==e.question.status&&1==e.question.is_require&&o&&N(Tt,"type_message",function(e){O(e,"textarea",function(e){e.value=o})}),a){var s={ev:"survey",department:t||"",name:n||"",email:i||"",phone:r||"",time:vt()};oe("cev",s),s.department&&(c.session.department=t),
s.phone&&Ae("phone",r),s.name&&Ae("name",n),s.email&&Ae("email",i),on(0),Jt(1)}else Dt("online")},ye=function(){var e=C(Tt,"v_name_contact").value,t=C(Tt,"v_email_contact").value,n=!0;if(e?J.remove(C(Tt,"v_name_contact"),"form-error"):(n=!1,J.add(C(Tt,"v_name_contact"),"form-error")),xt(t)?J.remove(C(Tt,"v_email_contact"),"form-error"):(n=!1,J.add(C(Tt,"v_email_contact"),"form-error")),n){var i={ev:"edit_contact",name:e,email:t,time:vt()};oe("cev",i),Ae("name",e),Ae("email",t),Qt(0),en(1)}},we=function(){
gt("save email transcript");var e=C(Tt,"v_email_transcript").value;if(xt(e)){J.remove(C(Tt,"v_email_transcript"),"form-error");var t={ev:"email_transcript",email:e,time:vt()};oe("cev",t),Ae("email",e),Wt(0)}else J.add(C(Tt,"v_email_transcript"),"form-error")},xe=function(e){var t=c.session;if(o&&clearInterval(o),o=setInterval(function(){var e={ev:"chatstates",state:"paused",time:vt()};oe("cev",e),t.is_typing=!1,clearInterval(o)},3e3),13===e.which){e.preventDefault(),clearInterval(o);var n="";if(N(Tt,"type_message",function(e){
O(e,"textarea",function(e){n=e.value})}),n=L.trim(n),gt(n),!n)return void N(Tt,"type_message",function(e){O(e,"textarea",function(e){e.value=""})});if("offline"==u.status_account)return;bn("",s.escape(n)),wn(0),oe("cev",{ev:"chat",message:n,url:de,time:vt()}),N(Tt,"type_message",function(e){O(e,"textarea",function(e){e.value=""})}),t.is_typing=!1,t.agent&&nt("SUBIZ Chat","Visitor chat",t.agent),s.isEmpty(c.triggers)||Ce("chat_message"),t.agent||ke(u.waiting_time),te.set("time_message",vt(),3e5)}else if(!t.is_typing){
t.is_typing=!0;var i={ev:"chatstates",state:"composing",time:vt()};oe("cev",i)}},ke=function(e){v.agent_busy&&(clearTimeout(v.agent_busy),v.agent_busy=null);var t=te.get("agent_busy");t||(v.agent_busy=setTimeout(function(){c.session.agent||c.lang.other.agent_busy&&(Tn(c.lang.other.agent_busy),te.set("agent_busy","1",3e5))},1e3*e))},ze=function(){var e=0;return N(Tt,"notice_new_message",function(t){e=B(t)}),e=parseInt(e,10),e=e>0?e:0},Ee=function(){if("desktop"!=c._device&&u._sbz_is_new_window&&("online"==u.status_widget?Ue():Fe()),
"desktop"==c._device)if(u.is_expand)"online"==u.status_widget?Re():Me();else{var e=c.session;e.is_expand&&1==e.is_expand&&(u.is_expand=1,"online"==u.status_widget?Ue():Fe())}var t=te.get("trigger_result");t&&(gt("last trigger result :",t),s.isObject(t)&&(g=t,s.each(c.triggers,function(e){if(g[e.id]){var t=g[e.id];e.is_check=t.is_check,e.is_match=t.is_match}else e.is_check=0,e.is_match=0}))),setInterval(function(){gt("----trigger---");var e=te.get("trigger_result");te.set("trigger_result",e,u.expire_store);

},1e4);var n=te.get("new_message");n&&(te.remove("new_message"),nn(n),Dt("online"));var i=te.get("sound");("on"==i||"off"==i)&&(te.remove("sound"),c.session.sound=i,Yt(i));var r=te.get("time_message");r=parseInt(r,10);var o=te.get("agent_busy");if(r>0&&!o){var a=vt(),l=a-r,f=u.waiting_time-l;!c.session.agent&&f>-45&&(l>u.waiting_time?ke(0):l>0&&ke(f))}c.session_ready=!0},Te=function(){v.presence&&(clearTimeout(v.presence),v.presence=null),u.socket_connected&&oe("cev",{ev:"presence_status"});var e=vt(),t=te.get("time_page")||vt(),n=e-t;

gt("time_on_page :",n);var i=6e4;i=n>900?3e5:6e4,v.presence=setTimeout(function(){Te()},i)},Ce=function(e,n){gt("trigger event :",e,n),gt("----------------------------------");var i=c.session,r=c.visitor_session,o=c.visitor;s.find(c.triggers,function(a){if(a.data.event!=e)return!1;if(n&&a.id!=n)return!1;if(a.is_match&&a.fire_once)return gt("ignore matched trigger :",a.id),!1;var c="trigger_"+a.id;v[c]&&clearTimeout(v[c]),gt("check trigger :",a);var l=s.first(a.data.condition),f=s.rest(a.data.condition),d=0,p=0;

s.each(f,function(e){var n=0,a="",s=e[2];if("@hour_of_day"==e[1])a=(new Date).getHours(),s=parseInt(s,10);else if("@day_of_week"==e[1])a=(new Date).getDay(),s=parseInt(s,10);else if("@visitor_time_on_site"==e[1]){a=0;var c=te.get("time_site");if(c=parseInt(c,10),c||(c=+new Date(r.time.start),c=Math.floor(c/1e3)),c){var u=vt();a=u-c,a=parseInt(Math.round(a),10)}s=parseInt(s,10),s>a&&(n=+new Date+1e3*(s-a))}else"@visitor_ip"==e[1]?a=r.ip:"@visitor_city"==e[1]?(a=i.geo.city,a=a.toLowerCase(),s=s.toLowerCase()):"@visitor_country_code"==e[1]?(a=i.geo.country,
a=a.toLowerCase(),s=s.toLowerCase()):"@visitor_country_name"==e[1]?(a=i.geo.country_name,a=a.toLowerCase(),s=s.toLowerCase()):"@visitor_page_url"==e[1]?(a=de,a=a.replace(/^(http:\/\/|https:\/\/)/gi,""),s=s.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_page_title"==e[1]?a=t.title:"@visitor_page_count"==e[1]?(a=r.page_visited.length,s=parseInt(s,10)):"@referrer"==e[1]?(a=t.referrer,a=a.replace(/^(http:\/\/|https:\/\/)/gi,""),s=s.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_name"==e[1]?a=o.name||"":"@visitor_email"==e[1]?a=o.email||"":"@visitor_phone"==e[1]?a=o.phone||"":"@visitor_referrer"==e[1]?(a=r.v.referrer,
a=a.replace(/^(http:\/\/|https:\/\/)/gi,""),s=s.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_search_engine"==e[1]?a=r.se&&r.se.name?r.se.name:"":"@visitor_search_terms"==e[1]?a=r.se&&r.se.kw?r.se.kw:"":"@visitor_type"==e[1]?(a=r.v.type,s=s.toLowerCase()):"@visitor_device"==e[1]?(a=b.detect()||"desktop",s=s.toLowerCase()):"@visitor_label"==e[1]&&(a=o.labels||[]);var l=Se(a,e[0],s);l?d++:n&&(!p||p>n)&&(p=n),gt(a+" "+e[0]+" "+s+" = "+l)});var _=0;"and"==l&&d==s.size(f)&&(_=1),"or"==l&&d>0&&(_=1),
a.is_match=_,a.is_check=1,g[a.id]={is_match:_,is_check:1},te.set("trigger_result",g,u.expire_store),gt("trigger result :",g);var m=te.get("__sbztrigger");if(gt("__sbztrigger :",m),_){gt("matched");var h=je(a);if(h){oe("cev",{ev:"trigger_result",id_trigger:a.id,status:"success",time:vt()});var y=te.get("__sbztrigger");y||(y={}),y[a.id]=1,te.set("__sbztrigger",y,u.expire_store)}}else{if(gt("NOT matched"),"page_enter"!=e)return!1;var w=(new Date).getTime();if(p&&p>=w){var x=p-w+1e3;gt("check again after "+x+"ms"),
v[c]=setTimeout(function(){Ce(e,a.id)},x)}}})},Se=function(e,t,n){if("eq"==t)return s.isArray(e)?s.contains(e,n)?!0:!1:e===n?!0:!1;if("neq"==t)return e!==n?!0:!1;if("lt"==t)return n>e?!0:!1;if("gt"==t)return e>n?!0:!1;if("lte"==t)return n>=e?!0:!1;if("gte"==t)return e>=n?!0:!1;if("icontains"==t){var i=(e+"").indexOf(n,0);return-1===i?!1:!0}if("nicontains"==t){var r=new RegExp(n,"g"),i=r.test(e);return i===!1?!0:!1}if("iregex"==t){var r=new RegExp(n,"gi"),i=r.test(e);return i?!0:!1}return"true"==t?e===!0?!0:!1:"false"==t&&e===!1?!0:!1;

},je=function(e){var t=!1;return s.find(e.data.actions,function(n,i){if(gt("run trigger action :",n),"autoInvite"==n[0]||"sendMessageToVisitor"==n[0]){if("offline"==u.status_account||"offline"==u.status_widget)return gt("already return :",u),!0;var r=te.get("__sbztrigger");if(gt("objtrigger",r),"autoInvite"==n[0]){var o=N(Tt,"line_message").length,a=c.session;if(o>0||a.agent)return r||(r={}),r[e.id]=1,te.set("__sbztrigger",r,u.expire_store),gt("already return 1 :",a),!0;if(r&&r[e.id])return gt("Trigger already run",e),
!0}else{var l=0;if(0==A(Tt,"supporter_chat, visitor_chat").length&&(l=1),e.fire_once&&r&&r[e.id])return gt("Trigger already run",e),!0}if(!s.isString(n[1][0])||!s.isString(n[1][1]))return gt("already return 2 "),!0;var f={name:n[1][0],avatar:n[1][1]},d=n[2];setTimeout(function(){oe("cev",{ev:"trigger_message",from:f,message:d,id_trigger:e.id,url:de,time:vt()})},200),bn(f,d),wn(0),N(Tt,"avatar_supporter",function(e){O(e,"img",function(e){$.set(e,"src",ft(f.avatar))})}),N(Tt,"name_supporter",function(e){
B(e,s.escape(f.name))}),"offline"==u.status_widget&&(u.status_widget="online",qt(0),St(1)),"survey"==u.widget_window?(on(0),Jt(1)):"online_compress"==u.widget_window&&("autoInvite"==n[0]?N(Tt,"button_chat_online",function(e){("desktop"==c._device||u._sbz_is_new_window)&&e.click()}):l?N(Tt,"button_chat_online",function(e){("desktop"==c._device||u._sbz_is_new_window)&&e.click()}):(it(),Dt("online"))),rt(),u._sbz_is_new_window||"desktop"==c._device||nn(1),ut(),t=!0}else"applyToLabel"==n[0]?(oe("cev",{
ev:"add_label",labels:n[1],id_trigger:e.id,url:de,time:vt()}),s.each(n[1],function(e){nt("Subiz Labels","TriggerAddLabel",e)}),t=!0):"removeToLabel"==n[0]&&(oe("cev",{ev:"remove_label",labels:n[1],id_trigger:e.id,url:de,time:vt()}),s.each(n[1],function(e){nt("Subiz Labels","TriggerRemovedLabel",e)}),t=!0)}),t},Oe=function(){var e={widget:u.status_widget,account:u.status_account,department:"",agent:""},t=c.session;return t.department&&s.each(c.departments,function(n){n.name==t.department&&(e.department=n.status);

}),t.agent&&s.each(c.agents,function(n){n.username==t.agent&&(e.agent="offline"==n.state?"offline":"online")}),e},Ne=function(){var e=c.session.department||"",t="";"online"==u.status_widget?O(C(Tt,"department"),"select",function(e){t=e.value}):O(C(Ct,"department"),"select",function(e){t=e.value,s.isEmpty(t)&&O(C(Ct,"department_edit"),"select",function(e){t=e.value})}),s.isEmpty(t)||(e=t),O(C(Tt,"department"),"select",function(e){e.options.length=0,e.options.add(new Option(c.lang.online.department_help,"")),
s.each(c.departments,function(t){"online"==t.status&&e.options.add(new Option(t.name,t.name))})}),O(C(Ct,"department"),"select",function(e){e.options.length=0,e.options.add(new Option(c.lang.online.department_help,"")),s.each(c.departments,function(t){e.options.add(new Option(t.name,t.name))})}),O(C(Ct,"department_edit"),"select",function(e){e.options.length=0,e.options.add(new Option(c.lang.online.department_help,"")),s.each(c.departments,function(t){e.options.add(new Option(t.name,t.name))})}),
s.isEmpty(e)||(O(C(Tt,"department"),"select",function(t){t.value=e}),O(C(Ct,"department"),"select",function(t){t.value=e}),O(C(Ct,"department_edit"),"select",function(t){t.value=e}))},Ae=function(e,t){if("undefined"==typeof t||!t)return!1;var n=c.visitor,i=s.escape(t);"name"==e?(n.name=t,N(Tt,"v_name",function(e){e.value=t}),N(Ct,"v_name",function(e){e.value=t}),N(Tt,"v_name_text",function(e){B(e,i)}),N(Ct,"v_name_text",function(e){B(e,i)}),N(Tt,"visitor_name",function(e){B(e,i)})):"email"==e?(n.email=t,
N(Tt,"v_email",function(e){e.value=t}),N(Ct,"v_email",function(e){e.value=t}),N(Tt,"v_email_text",function(e){B(e,i)}),N(Ct,"v_email_text",function(e){B(e,i)})):"phone"==e&&(n.phone=t,N(Tt,"v_phone",function(e){e.value=t}),N(Ct,"v_phone",function(e){e.value=t}))},Ie=function(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Byte";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]},Le=function(){if(N(Ct,"notification_widget",function(e){U(e);

}),N(Tt,"notification_widget",function(e){U(e)}),"online"==u.status_account){qt(0),St(1),Pt(0),Sn(0),Ht(1);var e=Oe(),t=!1;"offline"==e.agent&&"offline"==e.department&&(t=!0),"active"==c.widget.survey.status&&t&&c.history.length<1?(Jt(0),on(1)):(on(0),Jt(1)),yn("enable")}else St(0),qt(1),Bt(0),Xt(1),hn(0),mn(1),yn("enable");u.status_widget=u.status_account},$e=function(){c.session.department?Le():yn("enable")},Re=function(){Pt(0),Sn(0),Ht(1);var e=!1;if("active"==c.widget.survey.status){e=!0;var t=N(Tt,"line_message").length;

(c.session.agent||t>0)&&(e=!1)}e?(Jt(0),on(1)):(on(0),Jt(1)),nn(0)},Me=function(){Bt(0),Xt(1),hn(0),mn(1)},qe=function(){if(gt("io ready"),"offline"==u._status_account)return void(c.socket_ready=!0);var e=ot(),t=at(),n=[];if(n.push(u.aid),e&&n.push(e),t&&n.push(t),s.size(n)<3)return void console.log("Ignore connect socket");var i=yt(n.join(";"));l=new ie(u.url_socket,{server:i}),l.on("open",function(){gt("socket connected"),u.socket_connected=!0,c.socket_ready=!0,yn("enable"),N(Tt,"notification_reconnecting",function(e){
U(e)})}),l.on("message",function(e){De(e)}),l.on("close",function(e){gt("socket disconnect",e),u.socket_connected=!1,"force_close"==e.reason&&(gt("force close from server"),yn("disable"),Cn("Server is too busy! Please try again later."))}),l.on("reconnect",function(e){gt("socket reconnected"),u.socket_connected=!0,yn("enable"),ae(),u.click_reconnect&&(delete u.click_reconnect,N(Tt,"notification_reconnecting",function(e){U(e)}),N(Ct,"notification_reconnecting",function(e){U(e)}),$e()),Te()}),l.on("reconnect_failed",function(){
gt("socket reconnect failed - show notification"),u.socket_connected=!1,c.session&&c.session.agent&&tt(),yn("disable"),Tn('Lost connection! <a href="javascript:;" class="link_reconnect">Click here</a> to try reconnect.')}),l.connect()},De=function(e){if(gt(e),"init"==e.ev){if(!e.session||!e.session.vid)return void gt("init data is error");if(c.session=e.session||{},c.triggers=e.account.triggers||[],c.agents=e.account.agents||[],c.departments=e.account.departments||[],c.share_file=e.account.share_file||{},
c.history=e.history||[],c.visitor=e.session.visitor||{},c.visitor_session=e.session.visitor_session||{},st(e.session.vid),u._sbz_is_new_window||V.set("__sbzsid",e.session.sid),u._sbz_is_new_window_pc){var n="offline",i=u.sbz_agent,r=s.findWhere(e.account.agents,{username:i});r&&(n=r.state),u.status_widget=n}u.sbz_sid=e.session.sid,u.sbz_vid=e.session.vid,te.remove("is_init"),Pe("all",{check:function(){return c.base_ready&&c.socket_ready?!0:!1},success:function(){c.all_ready=!0,Be()},error:function(){
se()}})}else if("chat"==e.ev){var o=c.session,a=e.from.split("@")[0],l=Xe(a);if(!l)return;var f=0;if(!o.agent){f=1,o.agent=a,Zt(1),Vt(1),zn(1),rn(1);var d=c.lang.other.agent_join_chat;d=d.replace("{agent}",l.name),Tn(d),u.status_account="online",N(Tt,"type_message",function(e){O(e,"textarea",function(e){$.get(e,"disabled")&&yn("enable")})}),v.agent_busy&&(clearTimeout(v.agent_busy),v.agent_busy=null)}N(Tt,"avatar_supporter",function(e){O(e,"img",function(e){$.set(e,"src",ft(l.avatar))})}),N(Tt,"name_supporter",function(e){
B(e,s.escape(l.name))}),N(Tt,"text_supporter",function(e){B(e,s.escape(l.job_title))}),bn(l,s.escape(e.message)),wn(0),"offline"==u.status_widget&&(u.status_widget=u.status_account,qt(0),St(1),Pt(0),Ht(1),Sn(0),on(0),Jt(1)),"survey"==u.widget_window?(on(0),Jt(1)):"online_compress"==u.widget_window&&(it(),Dt("online"),f&&N(Tt,"button_chat_online",function(e){("desktop"==c._device||u._sbz_is_new_window)&&e.click()})),rt(),ct(),nt("SUBIZ Chat","Agent chat",o.agent),En(0)}else if("change_state"==e.ev){
var o=c.session,p="",_="offline",m="offline",p=Xe(e.agent);if(!p)return void gt("change_state - agent not in list");s.each(c.agents,function(t){t.username==e.agent&&(t.state=e.state,p=t),"online"==t.state&&("active"==c.widget.survey.status&&"active"==c.widget.survey.department?t.departments.length>0&&(_="online"):_="online",m="online"),"away"==t.state&&t.username==o.agent&&(_="online"),"away"==t.state&&"offline"==m&&(m="away")}),s.isEmpty(c.departments)||(s.each(c.departments,function(e,t){e.status="offline",
s.each(c.agents,function(t){"online"==t.state&&t.departments.length>0&&s.contains(t.departments,e.name)&&(e.status="online")})}),Ne()),u.status_account=_;var h=Oe(),b=u.widget_window;if("offline"==h.widget&&(!o.department&&"online"==h.account||o.department&&"online"==h.department))if("offline_compress"==b)qt(0),St(1),Ht(0),Ut(),Pt(1);else{var d=c.lang.other.agent_online;d=d.replace("{agent}",p.name),Cn(d,"account_online")}if("online"==h.widget&&"offline"==h.account)if("online_compress"==b){var y=ze();

if(y>0)return;St(0),qt(1),Xt(0),Ft(),Bt(1)}else yn("disable"),Cn(c.lang.other.agent_offline,"account_offline");u.status_widget=_,u._status_account=m,o.agent&&o.agent==e.agent&&"offline"==e.state&&(tt(),yn("disable"))}else if("agent_connection"==e.ev){var o=c.session;if(!o.agent||o.agent!=e.agent)return;var p=Xe(e.agent);if(!p)return;if("disconnect"==e.state){var d=c.lang.other.agent_disconnect;d=d.replace("{agent}",p.name),Tn(d)}else if("connect"==e.state){var d=c.lang.other.agent_reconnect;d=d.replace("{agent}",p.name),
Tn(d)}}else if("chatstates"==e.ev){var o=c.session,w=e.from.split("@")[0];o.agent&&o.agent==w&&("composing"==e.state?En(1,w):"paused"==e.state&&En(0))}else if("sync"==e.ev){if(e.name&&"file_upload"!=e.event_type&&Ae("name",e.name),e.name&&"file_upload"==e.event_type){var x=s.clone(e);x.url=u.url_file+e.path;var d=Ye(x);bn("",d)}if(e.email&&Ae("email",e.email),e.phone&&Ae("phone",e.phone),e.message&&(bn("",e.message),wn(0),qt(0),St(1),N(Tt,"button_chat_online",function(e){("desktop"==c._device||u._sbz_is_new_window)&&e.click();

})),"undefined"!=typeof e.is_expand){if("desktop"!=c._device&&!u._sbz_is_new_window)return;var k=1==e.is_expand?0:1,z=1==e.is_expand?1:0;u.is_expand=parseInt(e.is_expand,10),"online"==u.status_widget?(Pt(k),Ht(z),Sn(0)):(Bt(k),Xt(z))}}else if("block"==e.ev)N(t,"sbzon",function(e){U(e)}),N(t,"sbzoff",function(e){U(e)}),se(),V.set("__sbzbl","1",365);else if("transfer"==e.ev){var o=c.session,E=Xe(o.agent);if(!E)return;var d=c.lang.other.agent_left_chat;d=d.replace("{agent}",E.name),tt({message:d}),o.last_agent=o.agent,
delete o.agent,delete o.department,$e(),En(0)}else if("end_chat"==e.ev){var o=c.session,E=Xe(o.agent);if(!E)return;o.last_agent=o.agent,delete o.agent;var d=c.lang.other.agent_end_chat;d=d.replace("{agent}",E.name),Tn(d),En(0),Vt(0),zn(0),te.remove("time_message"),te.remove("agent_busy")}else if("full_slot"==e.ev){var T=c.session.visitor,d="",S=s.last(N(Tt,"visitor_content_chat"));S&&(d=X(S)),d&&(T.name||T.email?C(Ct,"v_message_offline").value=d:C(Ct,"v_message_offline_edit").value=d),St(0),qt(1),
Bt(0),Xt(1),mn(1)}else if("close"==e.ev)se();else if("lost_slot"==e.ev){var o=c.session;o.slot=""}else if("receive_slot"==e.ev){if(e.slot){var o=c.session;o.slot=e.slot,Te()}}else if("other_client_disconnect"==e.ev){e.sid&&(u._sbz_is_new_window||V.set("__sbzsid",e.sid),u.sbz_sid=e.sid);var j=te.get("time_site")||vt();if(te.set("time_site",j,u.expire_store),c.session_ready){te.set("trigger_result",g,u.expire_store);var A=te.get("__sbztrigger");te.set("__sbztrigger",A,u.expire_store);var y=ze();y>0&&te.set("new_message",y,u.expire_store),
c.session&&"off"==c.session.sound&&te.set("sound","off",u.expire_store),u.bubble&&te.set("bubble",u.bubble,u.expire_store)}}else if("presence"==e.ev)Te();else if("read"==e.ev)On();else if("ping"==e.ev)oe("cev",{ev:"pong",time:vt()});else if("file_upload"==e.ev){e.url=u.url_file+e.path;var d=Ye(e);s.each(c.agents,function(t){t.username==e.agent&&bn(t,d)})}},Pe=function(e,t){t=t||{},_[e]||(_[e]={time:0,expire:t.expire||6e4}),_[e].id&&(clearTimeout(_[e].id),_[e].id=null);var n=new Date;if(_[e].time>0){
if(n.getTime()-_[e].time>_[e].expire)return gt("wait ready is timeout : "+e),void(t.error&&t.error())}else _[e].time=n.getTime();var i=t.check();i?(gt(e+" is ready"),t.success()):(t.delay=t.delay?2*t.delay:200,_[e].id=setTimeout(function(){gt(e+" is not ready"),Pe(e,t)},t.delay))},He=function(){e.addEventListener("resize",function(){Dt(u.status_widget)});var n={config:u,lang:c.lang};c.html.online=s.template(c.html.online,n),c.html.offline=s.template(c.html.offline,n);var i=["online","offline"],r=i.length;

s.each(i,function(e){var n="online"==e?"sbzon":"sbzoff",i=s.template(c.html.iframe,{name:n});!function(e,n,i){var o=t.createElement("div");o.setAttribute("class",n),o.style.display="none",o.innerHTML='<iframe id="'+n+'_frame" frameborder="0" style="background-color: transparent; vertical-align: text-bottom; position: relative; width: 100%; height: 100%; margin: 0px; overflow: hidden;"></iframe>',O(o,"iframe",function(e){$.set(e,"src","javascript:false")}),t.body.appendChild(o);var a=C(t,n+"_frame").contentWindow.document;

a.write("<!DOCTYPE html><html><head></head><body></body></html>"),a.close(),setTimeout(function(){var i={"margin-top":"0px","margin-right":"0px","margin-bottom":"0px",padding:"0px",border:"0px","background-color":"rgba(0, 0, 0, 0)",overflow:"hidden",position:"fixed","z-index":"16000001",bottom:"0px",display:"block",width:"310px",height:"431px"},o="left"==u.position?"left":"right";i[o]="10px",N(t,n,function(e){D.set(e,i)});var a=C(t,n+"_frame").contentWindow.document;if("online"==e?Tt=a:"offline"==e&&(Ct=a),
O(a,"head",function(e){"fa"==c.lang_name&&(c.css=c.css.replace(/\/\*css_lang_fa/gi,""),c.css=c.css.replace(/end_css_lang_fa\*\//gi,"")),H(e,"<style>"+c.css+"</style>")}),O(a,"body",function(t){H(t,c.html[e])}),r--,0==r&&(c.base_ready=!0),c.base_ready){"online"==u.status_widget?(qt(0),St(1),u._sbz_is_new_window?(Jt(0),xn(1),Ht(1),Pt(0)):(Ht(0),Pt(1)),"desktop"==c._device||u._sbz_is_new_window||Ut()):(St(0),qt(1),u._sbz_is_new_window?(hn(0),mn(0),kn(1),Xt(1),Bt(0)):(Xt(0),Bt(1)),"desktop"==c._device||u._sbz_is_new_window||Ft()),
c.widget.theme.url_twitter&&(O(C(Tt,"twitter"),"a",function(e){$.set(e,"href",c.widget.theme.url_twitter)}),G(C(Tt,"twitter")),O(C(Ct,"twitter"),"a",function(e){$.set(e,"href",c.widget.theme.url_twitter)}),G(C(Ct,"twitter")),N(Tt,"btnoption",function(e){D.set(e,"margin-left","10px")})),c.widget.theme.url_facebook&&(O(C(Tt,"facebook"),"a",function(e){$.set(e,"href",c.widget.theme.url_facebook)}),G(C(Tt,"facebook")),O(C(Ct,"facebook"),"a",function(e){$.set(e,"href",c.widget.theme.url_facebook)}),G(C(Ct,"facebook")),
N(Tt,"btnoption",function(e){D.set(e,"margin-left","10px")})),"active"==c.widget.theme.logo_status&&c.widget.theme.logo_image&&(N(Tt,"logo_company",function(e){O(e,"img",function(e){$.set(e,"src",ft(c.widget.theme.logo_image))})}),jn(1));var l=V.get("__sbzbubble");if("off"==l&&(u.bubble="off",Sn(0)),"active"==c.widget.chat_bubble.status){O(C(Tt,"bubble_image"),"img",function(e){$.set(e,"src",ft(c.widget.chat_bubble.image))}),O(C(Tt,"bubble_image"),"img",function(e){q.on(e,"load",function(){gt("bubble",u.bubble),
u.bubble&&"off"==u.bubble||(Sn("desktop"!=c._device?0:1),Dt("online")),u.is_expand&&Sn(0)})});var f=Tt.getElementById("bubble_image");f.addEventListener("click",function(){Ue()}),q.on(C(Tt,"bubble_close"),"click",function(){Sn(0),u.bubble="off",V.set("__sbzbubble",u.bubble)})}var d=A(t,"#subiz_status, .subiz_status");if(d.length>0&&j(d,function(e){"online"==u.status_account?B(e,c.widget.chat_button.online_code):B(e,c.widget.chat_button.offline_code),"desktop"==c._device?q.on(e,"click",function(){
"online"==u.status_account?u.is_expand||Re():u.is_expand||Me()}):q.on(e,"click",function(){"online"==u.status_account?Ue():Fe()})}),q.on(Tt,"touchstart",".button_chat_online",Ue),q.on(Tt,"click",".button_chat_online",Ue),q.on(Tt,"click",".online_heading",function(){"desktop"==c._device&&(u.is_expand=0,oe("cev",{ev:"sync",is_expand:0,time:vt()}),Ht(0),Pt(1),"active"==c.widget.chat_bubble.status&&(u.bubble&&"off"==u.bubble||(Sn("desktop"!=c._device?0:1),Dt("online"))))}),"desktop"!=c._device)if("online"==u.status_account){
var p=Tt.getElementsByClassName("widget_body_footer")[0];p.lastElementChild.setAttribute("href","javascript:void(0)")}else{var p=Ct.getElementsByClassName("widget_body_footer")[0];p.lastElementChild.setAttribute("href","javascript:void(0)")}q.on(Ct,"touchstart",".button_chat_offline",Fe),q.on(Ct,"click",".button_chat_offline",Fe),q.on(Ct,"click",".offline_heading",function(){"desktop"==c._device&&(u.is_expand=0,oe("cev",{ev:"sync",is_expand:0,time:vt()}),Xt(0),Bt(1))}),u.share_file_status=!1,setTimeout(function(){
0==s.isEmpty(c.share_file)&&0==s.isEmpty(c.share_file.visitor)&&"active"==c.share_file.visitor.status&&(u.share_file_status=!0,Ot())},100)}},50)}(e,n,i)})},Ue=function(){if("desktop"!=c._device&&!u._sbz_is_new_window){var t=u.url_new_window,n=ot(),i=at(),r={};r.id=u.aid,r.sid=i,r.vid=n,r.wopen=c._device,r=m.stringify(r),r=btoa(r);var o="?param="+r+"&url="+encodeURIComponent(de)+"&title="+encodeURIComponent(fe);return t+=o,p=e.open(t,"subizNewWindow"),p.focus(),void nn(0)}u.is_expand||oe("cev",{ev:"sync",
is_expand:1,time:vt()}),u.is_expand=1,c.all_ready?(Re(),u.chat_requested||(u.chat_requested=1,Pe("trigger_chat_requested",{check:function(){return c.session_ready?!0:!1},success:function(){Ce("chat_requested")}}))):(on(0),Jt(0),xn(1),Pt(0),Ht(1)),"active"==c.widget.chat_bubble.status&&Sn(0)},Fe=function(){if("desktop"!=c._device&&!u._sbz_is_new_window){var t=u.url_new_window,n=ot(),i=at(),r={};r.id=u.aid,r.sid=i,r.vid=n,r.wopen=c._device,r=m.stringify(r),r=btoa(r);var o="?param="+r+"&url="+encodeURIComponent(de)+"&title="+encodeURIComponent(fe);

return t+=o,p=e.open(t,"subizNewWindow"),void p.focus()}u.is_expand||oe("cev",{ev:"sync",is_expand:1,time:vt()}),u.is_expand=1,c.all_ready?(gt("click expand widget offline - all ready"),Me()):(gt("click expand widget offline - all NOT ready"),E(C(Ct,"subiz_loading"))&&(gt("click expand widget offline - show loading"),hn(0),mn(0),kn(1),Bt(0),Xt(1)))},Be=function(){gt("Yes! Let's go!");var t=c.widget.survey,n=c.widget.offline_survey||{};s.isEmpty(c.departments)&&(t.department.status="inactive",n.department.status="inactive"),
"active"==t.status&&(an("active"==t.name.status?1:0),sn("active"==t.email.status?1:0),cn("active"==t.phone.status?1:0),un("active"==t.question.status?1:0),"active"==t.department.status?(Ne(),ln(1)):ln(0)),fn("active"==n.name.status?1:0),dn("active"==n.email.status?1:0),pn("active"==n.phone.status?1:0),"active"==n.department.status?(Ne(),_n(1)):_n(0);var i=c.visitor;i.name&&Ae("name",i.name),i.email&&Ae("email",i.email),i.phone&&Ae("phone",i.phone);var r=c.session;if(r.agent?(s.each(c.agents,function(e){
e.username==r.agent&&(N(Tt,"avatar_supporter",function(t){O(t,"img",function(t){$.set(t,"src",ft(e.avatar))})}),N(Tt,"name_supporter",function(t){B(t,s.escape(e.name))}),N(Tt,"text_supporter",function(t){B(t,s.escape(e.job_title))}))}),s.each(r.agents_rated,function(e,t){"good"==e?N(Tt,"rate-good",function(e){J.add(e,"rated")}):"bad"==e&&N(Tt,"rate-bad",function(e){J.add(e,"rated")})}),Zt(1),Vt(1),rn(1),zn(1)):(Zt(0),Vt(0),rn(0),zn(0)),c.history.length>0){wn(0);var o="",a="";s.each(c.history,function(e){
if("agent"==e.from.type)s.each(c.agents,function(t){if(t.username==e.from.user)if(o=t,"file_upload"!=e.event)bn(t,s.escape(e.message));else{var n=e.message;n=m.parse(n),n.url=u.url_file+n.path;var i=Ye(n);bn(t,i)}});else if("visitor"==e.from.type)if("file_upload"!=e.event)bn("",s.escape(e.message));else{var t=e.message;t=m.parse(t),t.url=u.url_file+t.path;var n=Ye(t);bn("",n)}else"trigger"==e.from.type?(a=e.from.user,bn(e.from.user,e.message)):"system"==e.from.type&&Tn(e.message)}),!o&&a&&(o=a),o&&(N(Tt,"avatar_supporter",function(e){
O(e,"img",function(e){$.set(e,"src",ft(o.avatar))})}),N(Tt,"name_supporter",function(e){B(e,s.escape(o.name))}))}xn(0),kn(0),gt("restore session"),Ee(),s.isEmpty(c.triggers)||Pe("trigger_page_enter",{check:function(){return c.session_ready?!0:!1},success:function(){Ce("page_enter")}}),u.socket_connected&&Te(),q.on(Tt,"click",".btn_start_chat",be),q.on(Tt,"click",".btnoption",function(){N(Tt,"option_form",function(e){Wt(E(e)?1:0)})}),q.on(Tt,"click",".sbz_upload_file",function(){N(Tt,"sbz_file_hide",function(e){
e.click()})}),Tt.getElementById("sbz_file_hide").addEventListener("change",function(){for(var e=0;e<this.files.length;e++){var t=this.files[e];Nt(t,c.share_file.extension)}At(u.file_support,u.file_not_support)},!1),Tt.getElementById("subiz_wrapper").addEventListener("dragover",function(e){N(Tt,"drag-container",function(e){G(e)}),e.preventDefault()},!1),Tt.getElementById("drag-container").addEventListener("dragleave",function(e){N(Tt,"drag-container",function(e){W(e)}),e.preventDefault()},!1),Tt.getElementById("subiz_wrapper").addEventListener("drop",function(e){
N(Tt,"drag-container",function(e){W(e)});for(var t=e.dataTransfer,n=t.files,i=0;i<n.length;i++){var r=n[i];Nt(r,c.share_file.extension)}At(u.file_support,u.file_not_support),e.preventDefault()},!1),Tt.getElementById("sbz__cancel_upload").addEventListener("click",function(){Je()}),Tt.getElementById("sbz__send_upload").addEventListener("click",function(){We(u.file_support,u.url_upload,c.share_file.extension),Je()}),q.on(A(Tt,".option_config_sound label, .option_config_sound i"),"click",function(){N(Tt,"option_config_sound",function(e){
O(e,"i",function(e){J.has(e,"icon_sound")?(Yt("off"),c.session.sound="off"):(Yt("on"),c.session.sound="on")})})}),q.on(C(Tt,"close_option"),"click",function(){Wt(0)}),q.on(Tt,"click",".btn_endchat",et),q.on(C(Tt,"end_chat_footer"),"click",et),q.on(C(Tt,"ec_close"),"click",function(){Kt(0)}),q.on(C(Tt,"edit_contact"),"click",function(){Gt(0);var e=c.visitor;e.name||e.email?(en(1),G(C(Tt,"v_name_contact_view")),e.name||W(C(Tt,"v_name_contact_view")),G(C(Tt,"v_email_contact_view")),e.email||W(C(Tt,"v_email_contact_view"))):Qt(1);

}),q.on(C(Tt,"edit_successful"),"click",ye),q.on(C(Tt,"icon_edit_contact"),"click",function(){en(0),Qt(1)}),q.on(C(Tt,"icon_close_contact"),"click",function(){Wt(0)}),q.on(C(Tt,"email_transcript"),"click",function(){Gt(0),tn(1)}),q.on(C(Tt,"save_email_transcript"),"click",we),q.on(C(Tt,"cancel_email_transcript"),"click",function(){Wt(0)}),q.on(C(Tt,"cancel_contact"),"click",function(){Wt(0)}),q.on(Tt,"click",".visitor_name",function(){Wt(1),Gt(0),C(Tt,"edit_contact").click()}),q.on(C(Tt,"rate_good"),"click",ve),
q.on(C(Tt,"rate_bad"),"click",ge),q.on(C(Tt,"ec_rate_good"),"click",function(){C(Tt,"rate_good").click(),Kt(0)}),q.on(C(Tt,"ec_rate_bad"),"click",function(){C(Tt,"rate_bad").click(),Kt(0)}),N(Tt,"textarea_online",function(e){q.on(e,"keypress",xe),q.on(e,"blur",function(){if(c.session.is_typing){c.session.is_typing=!1;var e={ev:"chatstates",state:"paused",time:vt()};oe("cev",e)}})}),q.on(Tt,"click",".link_offline",function(){if("offline"==u.status_account){var e="";N(Tt,"type_message",function(t){
O(t,"textarea",function(t){e=t.value})}),N(Ct,"textarea_offline",function(t){t.value=e})}Le()}),q.on(C(Ct,"send_message_offline"),"click",me),q.on(C(Ct,"send_message_offline_edit"),"click",he),q.on(C(Ct,"icon_edit_contact_offline"),"click",function(){vn(0),gn(1)}),q.on(C(Ct,"v_message_offline"),"change",function(){var e=C(Ct,"v_message_offline").value;C(Ct,"v_message_offline_edit").value=e,B(C(Ct,"message_offline_text"),s.escape(e))}),q.on(C(Ct,"v_message_offline_edit"),"change",function(){var e=C(Ct,"v_message_offline_edit").value;

C(Ct,"v_message_offline").value=e,B(C(Ct,"message_offline_text"),s.escape(e))}),q.on(Ct,"click",".btn_send_another",function(){hn(0),vn(1),C(Ct,"v_message_offline").value="",C(Ct,"v_message_offline_edit").value=""}),q.on(Tt,"click",".close_notification_widget",function(){var e=this;N(Tt,"chat_warning",function(t){z(t,e)&&U(t)})}),q.on(Ct,"click",".close_notification_widget",function(){var e=this;N(Ct,"chat_warning",function(t){z(t,e)&&U(t)})}),q.on(Tt,"click",".link_reconnect",function(){u.socket_connected?$e():(Cn("Reconnecting...","reconnecting"),
u.click_reconnect=1,re())}),q.on(Tt,"click",".link_refresh",function(){Le()}),q.on(Ct,"click",".link_refresh",function(){Le()}),q.on(Tt,"click",".link_chat_again",function(){$e()}),q.on(C(Tt,"ec_chat_again"),"click",function(){Kt(0),$e()});var l=function(){var e={ev:"chatstates",state:"paused",time:vt()};oe("cev",e);var t=at();t&&(V.set("__sbzsid",t,60/86400),u.sbz_sid=t),te.remove("is_init");var n=te.get("time_site")||vt();if(te.set("time_site",n,u.time_visitor_offline),c.session_ready){te.set("trigger_result",g,u.time_visitor_offline);

var i=te.get("__sbztrigger");te.set("__sbztrigger",i,u.time_visitor_offline);var r=ze();r>0&&te.set("new_message",r,u.time_visitor_offline),c.session&&"off"==c.session.sound&&te.set("sound","off",u.time_visitor_offline),u.bubble&&te.set("bubble",u.bubble,u.time_visitor_offline)}};e.addEventListener("unload",l,!1);var f=function(e){if(ce!=e.type)switch(e.type){case"blur":break;case"focus":}ce=e.type};e.addEventListener("blur",f,!1),e.addEventListener("focus",f,!1),u.idle_time=0,u.is_idle=0,r.status_activity&&"idle"==r.status_activity&&(u.is_idle=1);

var d=function(){u.idle_time+=1,u.idle_time>=5&&(gt("visitor idle"),u.is_idle||(u.is_idle=1,oe("cev",{ev:"change_activity",status:"idle"})),v.idle&&(clearInterval(v.idle),v.idle=null))},p=function(){u.idle_time=0,u.is_idle&&(gt("visitor active"),u.is_idle=0,oe("cev",{ev:"change_activity",status:"active"})),v.idle||(v.idle=setInterval(d,6e4))};p(),e.addEventListener("mousemove",p,!1),e.addEventListener("keypress",p,!1),Tt.addEventListener("mousemove",p,!1),Tt.addEventListener("keypress",p,!1)},Xe=function(e){
var t="";return s.each(c.agents,function(n){n.username==e&&(t=n)}),t},Je=function(){Mt(),u.file_support=[],u.file_not_support=[],u.all_file=[],u.max_size=0,u.max_file=0,N(Tt,"btn-cancel-file",function(e){U(e)})},We=function(e,t,n){if(0==u.share_file_status)return void console.log("visitor send file inactive");var i=new XMLHttpRequest,r=new FormData,o=ot(),a=at();Mt();for(var s=0;s<e.length;s++){for(var c=e[s],l=!1,f=c.name.split(".").pop(),d=0;d<n.length;d++)n[d]==f&&(l=!0);if(1==l){r.append("files",c);

var p=Ge(c.name);bn("",p)}}r.append("aid",u.aid),r.append("vid",o),r.append("sid",a),i.open("POST",t,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?Ve(i.responseText,e):Qe(e))},i.send(r)},Ge=function(e){var t=e.split(".").pop(),n=Ke(t),i=Ze(e,40),r='<span class="file-uploading" rel="pending-'+s.escape(e)+'"><i class="fa '+n+' progress-button"></i> '+i+'<span class="progress-bar blue shine"><span style="width:100%"></span></span></span>';return r},Ze=function(e,t){if(e.length<t||e.length<20)return e;

var n=e.length,i=t-15;i>20&&(i=20);var r=e.substring(0,i);return r+=".....",r+=e.substring(n-10,n)},Ve=function(e,t){var n=m.parse(e);if("success"!=n.status)return void Qe(t);for(var i=0;i<n.files.length;i++){var r={ev:"file_upload",name:n.files[i].name,original_name:n.files[i].original_name,path:n.files[i].path,size:n.files[i].size,mimetype:n.files[i].mimetype},o=r;o.url=u.url_file+n.files[i].path,N(Tt,"file-uploading",function(e){var t="pending-"+unescape(n.files[i].original_name);if(e.getAttribute("rel")==t){
e.setAttribute("rel","");var r=Ye(o);B(e,r)}}),oe("cev",r)}},Ye=function(e){var t=e.original_name.split(".").pop(),n=Ke(t),i=Ze(e.original_name,25),r=e.size,o='<a target="_blank" href="'+e.url+'" ><i class="fa '+n+' progress-button"></i> '+i+"</a>";return("image/jpeg"==e.mimetype||"image/jpg"==e.mimetype||"image/gif"==e.mimetype||"image/png"==e.mimetype)&&2e6>r&&(t=t.toUpperCase(),o='<a target="_blank" href="'+e.url+'" ><img class="thumb-upload" src="'+e.url+'" ></a><span class="thumb-upload-info"><p><a target="_blank" href="'+e.url+'">'+i+"</a></p><p>"+t+" file</p><p>"+Ie(r)+"</p></span>"),
o},Ke=function(e){var t="fa-file-archive-o";return("doc"==e||"docx"==e)&&(t="fa-file-word-o"),("xls"==e||"xlsx"==e)&&(t="fa-file-excel-o"),"pdf"==e&&(t="fa-file-pdf-o"),("png"==e||"jpg"==e||"jpeg"==e||"gif"==e)&&(t="fa-file-image-o"),t},Qe=function(e){for(var t=0;t<e.length;t++){var n=e[t];N(Tt,"file-uploading",function(e){var t="pending-"+n.name;if(e.getAttribute("rel")==t){var i=n.name.split(".").pop(),r=Ke(i);e.setAttribute("rel","");var o=Ze(n.name,25),a='<i class="fa '+r+' progress-button"></i> '+o+'<p class="canceled">Upload failed</p>';

B(e,a)}})}},et=function(){var e=Xe(c.session.agent);if(e){var t=c.lang.online.ec_message;t=t.replace("{agent}",s.escape(e.name)),A(Tt,".endchat_form .endchat_label",function(e){B(e,t)}),Wt(0),Kt(1),tt(),oe("cev",{ev:"end_chat",time:vt()})}},tt=function(e){var t=c.lang.other.visitor_end_chat;"undefined"!=typeof e&&e.message&&(t=e.message),Tn(t),yn("disable"),Vt(0),zn(0);var n=c.session;n.last_agent=n.agent,delete n.agent,te.remove("time_message"),te.remove("agent_busy")},nt=function(t,n,i){if("function"==typeof e.ga&&"function"==typeof e.ga.getAll)if("undefined"!=typeof i)for(var r=e.ga.getAll(),o=0;o<r.length;++o){
var a=r[o],s=a.get("name");e.ga(s+".send","event",t,n,i)}else for(var r=e.ga.getAll(),o=0;o<r.length;++o){var a=r[o],s=a.get("name");e.ga(s+".send","event",t,n)}},it=function(){var e=ze();e++,nn(e)},rt=function(){var t=u.new_message_on_page||0,n=ze();n>0?(t=n,bt("("+t+") "+d)):"blur"==ce&&(t++,u.new_message_on_page=t,bt("("+t+") "+d)),u._sbz_is_new_window&&(e.addEventListener("focus",mt,!1),e.addEventListener("mousemove",mt,!1),Tt.addEventListener("focus",mt,!1),Tt.addEventListener("mousemove",mt,!1));

},ot=function(){var e="",t=te.get("id")||"",n=V.get("__sbzid")||"";return"desktop"!=c._device&&u._sbz_is_new_window?e=u.sbz_vid:u._sbz_is_new_window_pc||u._sbz_is_new_window?e=u.sbz_vid:(t?(e=t,n||V.set("__sbzid",e,365)):n&&(e=n,te.set("id",e)),e)},at=function(){var e="";return u._sbz_is_new_window&&(e=u.sbz_sid)?e:(e=u.sbz_sid)?e:e=V.get("__sbzsid")||""},st=function(e){u._sbz_is_new_window||u._sbz_is_new_window_pc||(te.set("id",e),V.set("__sbzid",e,365))},ct=function(){var e=c.session.sound||"on";

"blur"==ce&&"on"==e&&(gt(C(Tt,"audio_alert").readyState),0!=C(Tt,"audio_alert").readyState?C(Tt,"audio_alert").play():(C(Tt,"audio_alert").load(),C(Tt,"audio_alert").play()))},ut=function(){var e=c.session.sound||"on";"on"==e&&(0!=C(Tt,"audio_alert").readyState?C(Tt,"audio_alert").play():(C(Tt,"audio_alert").load(),C(Tt,"audio_alert").play()))},lt={_setAccount:function(e){u.aid=e;var t=ot(),n=at(),i=te.get("is_init")||0;t&&n||!i?_e():Pe("other_init",{check:function(){var e=ot(),t=at(),n=te.get("is_init")||0;

return e&&t||!n?!0:!1},success:function(){_e()}})},expandWidget:function(){var e="api_expand_widget:"+ +new Date;Pe(e,{check:function(){return c.base_ready?!0:!1},success:function(){u.is_expand||("online"==u.status_widget?Ue():Fe())}})},setInfo:function(e){if(!("undefined"==typeof e||e.length<1)){var t="api_set_info:"+ +new Date;Pe(t,{check:function(){return c.all_ready&&c.socket_ready?!0:!1},success:function(){var t=s.pick(e,["name","email","phone"]);if(s.each(t,function(e,n){s.isEmpty(e)&&delete t[n];

}),!s.isEmpty(t))if(s.each(t,function(e,t){"email"==t?xt(e)&&Ae(t,e):Ae(t,e)}),"offline"==u._status_account){var n=ot(),i=at(),r={aid:u.aid,vid:n,sid:i};r=s.extend(r,t);var o=u.url_sock_p+"ev/set_info";K(o,{data:r,success:function(e){},error:function(e){}})}else oe("cev",s.extend(t,{ev:"set_info"}))}})}},getInfo:function(e){if("function"==typeof e){var t="api_get_info:"+ +new Date;Pe(t,{check:function(){return c.all_ready?!0:!1},success:function(){var t=c.visitor,n=(c.visitor_session,c.session),i={
id:n.vid,ip:n.ip,name:t.name||"",email:t.email||"",phone:t.phone||"",labels:t.labels||[],city:n.geo.city,country_code:n.geo.country,country_name:n.geo.country_name};e(i)}})}}},ft=function(e){if(!e)return"";var n="https:"==t.location.protocol?"https://":"http://";return e=e.replace(/^https?\:\/\//gi,""),e=n+e},dt=function(n){{var i,r,o,a,s,u=e.innerHeight;e.innerWidth}if("online"==n){N(Tt,"widget_body_inner",function(e){i=e.offsetHeight}),N(Tt,"online_heading",function(e){r=e.offsetHeight}),N(Tt,"widget_body_footer",function(e){
o=e.offsetHeight}),N(Tt,"type_message",function(e){a=e.offsetHeight}),N(Tt,"widget_online_top",function(e){s=e.offsetHeight});var l=u-r-o,f=u-r-o-a-s;N(Tt,"widget_body",function(e){D.set(e,"height",u-10+"px")}),N(Tt,"widget_body_inner",function(e){D.set(e,"height",l-12+"px")}),N(Tt,"subiz_conversionin",function(e){D.set(e,"height",f-35+"px")})}else{N(Ct,"widget_body_inner",function(e){i=e.offsetHeight}),N(Ct,"offline_heading",function(e){r=e.offsetHeight}),N(Ct,"widget_body_footer",function(e){o=e.offsetHeight;

}),N(Ct,"type_message",function(e){a=e.offsetHeight}),N(Ct,"widget_online_top",function(e){s=e.offsetHeight});var l=u-r-o,f=u-r-o-a-s;N(Ct,"widget_body",function(e){D.set(e,"height",u-10+"px")}),N(Ct,"widget_body_inner",function(e){D.set(e,"height",l-12+"px")}),N(Ct,"subiz_conversionin",function(e){D.set(e,"height",f-35+"px")})}N(t,"sbzon",function(e){D.set(e,"right","0px"),D.set(e,"left","0px")}),N(t,"sbzoff",function(e){D.set(e,"right","0px"),D.set(e,"left","0px")}),"desktop"!=c._device&&N(Tt,"textarea_online",function(e){
$.set(e,"rows","1")})},pt=function(e,t){D.set(e,{transform:"scale("+t+")","-ms-transform":"scale("+t+")","-moz-transform":"scale("+t+")","-webkit-transform":"scale("+t+")","-o-transform":"scale("+t+")"})},_t=function(n){var i=e.innerHeight,r=e.innerWidth,o=t.doctype,a=!1;if(o&&o.publicId){var s=o.publicId;s=s.toLowerCase(),s.indexOf("-//wapforum//dtd xhtml mobile")>-1&&(a=!0)}if("online"==n){if(t.querySelector("meta[name=viewport]")||1==a)return N(Tt,"button_chat_online",function(e){pt(e,1)}),t.querySelector("meta[name=viewport]")||1!=a||(b.iphone()||b.ipod())&&(r>i?N(Tt,"button_chat_online",function(e){
pt(e,1.3)}):N(Tt,"button_chat_online",function(e){pt(e,2.3)})),void Ut();"mobile"==c._device&&(gt("mobile",r,i),r>i?N(Tt,"button_chat_online",function(e){pt(e,1.3)}):N(Tt,"button_chat_online",function(e){pt(e,2.3)})),"tablet"==c._device&&(r>i?N(Tt,"button_chat_online",function(e){pt(e,1)}):N(Tt,"button_chat_online",function(e){pt(e,1.5)})),Ut()}else{if(t.querySelector("meta[name=viewport]")||1==a)return N(Ct,"button_chat_offline",function(e){pt(e,1)}),t.querySelector("meta[name=viewport]")||1!=a||(b.iphone()||b.ipod())&&(r>i?N(Ct,"button_chat_offline",function(e){
pt(e,1.3)}):N(Ct,"button_chat_offline",function(e){pt(e,2.3)})),void Ft();"mobile"==c._device&&(r>i?N(Ct,"button_chat_offline",function(e){pt(e,1.3)}):N(Ct,"button_chat_offline",function(e){pt(e,2.3)})),"tablet"==c._device&&(r>i?N(Ct,"button_chat_offline",function(e){pt(e,1)}):N(Ct,"button_chat_offline",function(e){pt(e,1.5)})),Ft()}},vt=function(){var e=Math.floor(+new Date/1e3);return e},gt=function(){if(le){if(arguments.length<1)return;Function.prototype.apply.call(console.log,console,arguments);

}},mt=function(t){u._sbz_is_new_window&&oe("cev",{ev:"read",ev_type:"forward"}),e.removeEventListener("focus",mt,!1),e.removeEventListener("mousemove",mt,!1),Tt.removeEventListener("focus",mt,!1),Tt.removeEventListener("mousemove",mt,!1),t.preventDefault()},ht=function(){gt("clear blink"),v.new_message&&(clearInterval(v.new_message),v.new_message=null),t.title=d,u.new_message_on_page=0,e.removeEventListener("mousemove",ht),e.removeEventListener("focus",ht),Tt.removeEventListener("mousemove",ht),Tt.removeEventListener("focus",ht);

},bt=function(n){var i=function(){t.title=t.title==d?n:d},r=u.new_message_on_page||0;ht(),u.new_message_on_page=r,v.new_message||(gt("set blink"),v.new_message=setInterval(i,500),e.addEventListener("mousemove",ht,!1),e.addEventListener("focus",ht,!1),Tt.addEventListener("mousemove",ht,!1),Tt.addEventListener("focus",ht,!1))},yt=function(e){for(var t="0x",n=e.length,i=0;n>i;i++)t+=e.charCodeAt(i).toString(16);return t},wt=function(e,t){for(var n="",i="",r=0;r<t.length;r++)i.indexOf(t.charAt(r))<0&&(i+=t.charAt(r));

for(var o=i.length,r=0;r<=e.length-1;r++){var a=parseInt(e.charCodeAt(r));if(13==a&&(a=13),10==a&&(a=10),13!=a&&10!=a){var s=r%o;for(a=parseInt(e.charCodeAt(r)-i.charCodeAt(o-1)-s),a>126&&(a%=94);32>a;)a=a%94+94}n+=String.fromCharCode(parseInt(a))}return n},xt=function(e){var e=e||"",t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},kt=["push","slice","apply","length","reverse","pop","_sbzq"],zt=kt[0],Et=function(e){
var t=e[0],n=e[kt[1]](1);lt[t][kt[2]](this,n)},Tt=null,Ct=null,St=function(e){var n="sbzon";e?(N(t,n,function(e){G(e)}),u.status_widget="online"):N(t,n,function(e){W(e)})},jt=function(){var e="attach-confirm";N(Tt,e,function(e){G(e)})},Ot=function(){var e="sbz_upload_file";N(Tt,e,function(e){G(e)})},Nt=function(e,t){if(0==u.share_file_status)return void console.log("visitor send file inactive");for(var n=!1,i=!0,r=e.name.split(".").pop(),o=0;o<t.length;o++)t[o]==r&&(n=!0);e.size>10485760&&(i=!1),
1==n&&1==i?(u.file_support.push(e),u.max_file=u.max_file+1,u.max_size=u.max_size+e.size):u.file_not_support.push(e),u.all_file.push(e)},At=function(e,t){if(N(Tt,"attach-confirm",function(e){O(e,"h4",function(e){G(e)})}),N(Tt,"btn-send-file",function(e){G(e)}),N(Tt,"cancel-upload",function(e){G(e)}),0==u.share_file_status)return void console.log("visitor send file inactive");jt();var n=!1,i=!1;if(0==s.isEmpty(e)&&0==s.isEmpty(t)&&(n=!0),1==s.isEmpty(e)&&0==s.isEmpty(t)&&(i=!0),u.max_size>52428800){
var r=c.lang.online.sh_title_unsupport||"Unsupported file types can't be uploaded";return void $t(u.all_file,r)}if(u.max_file>10){var r=c.lang.online.sh_title_unsupport||"Unsupported file types can't be uploaded";return void $t(u.all_file,r)}if(0==s.isEmpty(e)&&(1==n?Lt(e,r):It(e)),0==s.isEmpty(t)){if(1==i){var r=c.lang.online.sh_title_unsupport||"Unsupported file types can't be uploaded";$t(t,r)}if(1==n){var r=c.lang.online.sh_title_unsupport||"Unsupported file types can't be uploaded";Rt(t,r)}}
},It=function(e,t){for(var n="",i=0;i<e.length;i++){var r=e[i],o=Ze(r.name,40);n+='<div class="attach-file-info"><span class="file-name"><i class="fa fa-file"></i> '+o+'</span><span class="file-size">'+Ie(r.size)+"</span></div>"}N(Tt,"sbz__list_file",function(e){n='<div class="file-attach-list">'+n+"</div>",H(e,n)})},Lt=function(e,t){for(var n="",i=0;i<e.length;i++){var r=e[i],o=Ze(r.name,40);n+='<div class="attach-file-info"><span class="file-name"><i class="fa fa-file"></i> '+o+'</span><span class="file-size">'+Ie(r.size)+"</span></div>";

}N(Tt,"sbz__list_file",function(e){n='<div class="file-attach-list" style="max-height:120px">'+n+"</div>",H(e,n)})},$t=function(e,t){for(var n="",i=0;i<e.length;i++){var r=e[i],o=Ze(r.name,40);n+='<div class="attach-file-info not-support"><span class="file-name"><i class="fa fa-file"></i> '+o+'</span><span class="file-size">'+Ie(r.size)+"</span></div>"}n='<div class="file-attach-error-list"><span class="attach-error-message">'+t+"</span>"+n+"</div>",N(Tt,"sbz__list_file",function(e){H(e,n)}),N(Tt,"attach-action",function(e){
var t='<a class="btn-cancel-file" id="sbz__cancel_upload_btn">Cancel</a>';H(e,t),Tt.getElementById("sbz__cancel_upload_btn").addEventListener("click",function(){Je()})}),N(Tt,"btn-send-file",function(e){W(e)}),N(Tt,"cancel-upload",function(e){W(e)}),N(Tt,"attach-confirm",function(e){O(e,"h4",function(e){W(e)})})},Rt=function(e,t){for(var n="",i=0;i<e.length;i++){var r=e[i],o=Ze(r.name,40);n+='<div class="attach-file-info not-support"><span class="file-name"><i class="fa fa-file"></i> '+o+'</span><span class="file-size">'+Ie(r.size)+"</span></div>";

}n='<div class="file-attach-error-list" style="max-height:120px;"><span class="attach-error-message">'+t+"</span>"+n+"</div>",N(Tt,"sbz__list_file",function(e){H(e,n)})},Mt=function(){N(Tt,"file-attach-list",function(e){U(e)}),N(Tt,"file-attach-error-list",function(e){U(e)}),N(Tt,"attach-confirm",function(e){W(e)})},qt=function(e){var n="sbzoff";e?(N(t,n,function(e){G(e)}),u.status_widget="offline"):N(t,n,function(e){W(e)})},Dt=function(e,n){if("desktop"!=c._device&&u._sbz_is_new_window&&dt(e),"desktop"!=c._device&&!u._sbz_is_new_window)return void _t(e);

if("online"==e){N(t,"sbzon",function(e){D.set(e,{width:"100%",height:"100%"})});var i=C(Tt,"subiz_wrapper").offsetWidth,r=C(Tt,"subiz_wrapper").offsetHeight;N(t,"sbzon",function(e){D.set(e,{width:i+1,height:r})}),"undefined"!=typeof n&&("undefined"!=typeof n.height&&n.height&&N(t,"sbzon",function(e){D.set(e,"height",n.height)}),"undefined"!=typeof n.width&&n.width&&N(t,"sbzon",function(e){D.set(e,"width",n.width)}))}else{N(t,"sbzoff",function(e){D.set(e,{width:"100%",height:"100%"})});var i=C(Ct,"subiz_wrapper").offsetWidth,r=C(Ct,"subiz_wrapper").offsetHeight;

N(t,"sbzoff",function(e){D.set(e,{width:i+1,height:r})}),"undefined"!=typeof n&&("undefined"!=typeof n.height&&n.height&&N(t,"sbzoff",function(e){D.set(e,"height",n.height)}),"undefined"!=typeof n.width&&n.width&&N(t,"sbzoff",function(e){D.set(e,"width",n.width)}))}},Pt=function(e){var t="button_chat_online";e?(N(Tt,t,function(e){G(e)}),Dt("online"),u.widget_window="online_compress"):N(Tt,t,function(e){W(e)})},Ht=function(e){var t="widget_body";e?(N(Tt,t,function(e){G(e)}),Dt("online")):N(Tt,t,function(e){
W(e)})},Ut=function(){var e,n;N(Tt,"button_chat_online",function(t){e=t.getBoundingClientRect().width,n=t.getBoundingClientRect().height}),N(t,"sbzon",function(t){D.set(t,"width",e+"px")}),N(t,"sbzon",function(e){D.set(e,"height",n+"px")})},Ft=function(){var e,n;N(Ct,"button_chat_offline",function(t){e=t.getBoundingClientRect().width,n=t.getBoundingClientRect().height}),N(t,"sbzoff",function(t){D.set(t,"width",e+"px")}),N(t,"sbzoff",function(e){D.set(e,"height",n+"px")})},Bt=function(e){var t="button_chat_offline";

e?(N(Ct,t,function(e){G(e)}),Dt("offline"),u.widget_window="offline_compress"):N(Ct,t,function(e){W(e)})},Xt=function(e){var t="widget_body";e?(N(Ct,t,function(e){G(e)}),Dt("offline")):N(Ct,t,function(e){W(e)})},Jt=function(e){var t="subiz_chat";e?(G(C(Tt,t)),Dt("online"),Nn(),u.widget_window="chat"):W(C(Tt,t))},Wt=function(e){var t="option_form";e?(Qt(0),en(0),tn(0),Gt(1),N(Tt,t,function(e){G(e)})):(N(Tt,t,function(e){W(e)}),Qt(0),en(0),tn(0),Gt(1))},Gt=function(e){var t="option_default";e?G(C(Tt,t)):W(C(Tt,t));

},Zt=function(e){var t="email_transcript";e?G(C(Tt,t).parentNode):W(C(Tt,t).parentNode)},Vt=function(e){var t="btn_endchat";e?G(C(Tt,t).parentNode):W(C(Tt,t).parentNode)},Yt=function(e){var t="option_config_sound";"on"==e?N(Tt,t,function(e){O(e,"i",function(e){J.remove(e,"icon_sound_off"),J.add(e,"icon_sound")})}):N(Tt,t,function(e){O(e,"i",function(e){J.remove(e,"icon_sound"),J.add(e,"icon_sound_off")})})},Kt=function(e){var t="endchat_form";e?N(Tt,t,function(e){D.set(e,"display","inline")}):N(Tt,t,function(e){
W(e)})},Qt=function(e){var t="option_contact_details";e?G(C(Tt,t)):W(C(Tt,t))},en=function(e){var t="option_edit_successful";e?G(C(Tt,t)):W(C(Tt,t))},tn=function(e){var t="option_email_transcript";e?G(C(Tt,t)):W(C(Tt,t))},nn=function(e){var t="notice_new_message";e&&e>0?N(Tt,t,function(t){B(t,e+""),G(t)}):N(Tt,t,function(e){B(e,"0"),W(e)})},rn=function(e){var t="bl_rating";e?G(C(Tt,t)):W(C(Tt,t))},on=function(e){var t="survey";e?(G(C(Tt,t)),Dt("online"),u.widget_window="survey"):W(C(Tt,t))},an=function(e){
var t="v_name_survey";e?G(y(C(Tt,t),"div")):W(y(C(Tt,t),"div"))},sn=function(e){var t="v_email_survey";e?G(y(C(Tt,t),"div")):W(y(C(Tt,t),"div"))},cn=function(e){var t="v_phone_survey";e?G(y(C(Tt,t),"div")):W(y(C(Tt,t),"div"))},un=function(e){var t="v_question_survey";e?G(y(C(Tt,t),"div")):W(y(C(Tt,t),"div"))},ln=function(e){var t="department";e?G(C(Tt,t)):W(C(Tt,t))},fn=function(e){var t="v_name_offline";e?G(y(C(Ct,t),"div")):W(y(C(Ct,t),"div"))},dn=function(e){var t="v_email_offline";e?G(y(C(Ct,t),"div")):W(y(C(Ct,t),"div"));

},pn=function(e){var t="v_phone_offline";e?G(y(C(Ct,t),"div")):W(y(C(Ct,t),"div"))},_n=function(e){var t="department_edit",n="department";e?(G(C(Ct,t)),G(C(Ct,n))):(W(C(Ct,t)),W(C(Ct,n)))},vn=function(e){var t="offline_active_box";e?(G(C(Ct,t)),Dt("offline"),u.widget_window="message_offline"):W(C(Ct,t))},gn=function(e){var t="subiz_offline";e?(G(C(Ct,t)),Dt("offline"),u.widget_window="message_offline"):W(C(Ct,t))},mn=function(e){var t=c.visitor;if(e){var n=!0;t.name&&(n=!1,Ae("name",t.name)),t.email&&(n=!1,
Ae("email",t.email)),n?(vn(0),gn(1)):(gn(0),vn(1)),u.widget_window="message_offline"}else gn(0),vn(0)},hn=function(e){var t="message_successful";e?(G(C(Ct,t)),Dt("offline"),u.widget_window="thank_you"):W(C(Ct,t))},bn=function(e,t){t=h.link(t,{stripPrefix:!0}),t=t.replace(/(\r\n|\n|\r)/gm,"<br>"),e=e||"",e&&!e.name&&(e={name:"Agent",avatar:u.url_avatar});var n=""==e?"visitor_chat":"supporter_chat",i=s.last(A(Tt,".subiz_conversionin > div.visitor_chat, div.supporter_chat")),r="";if(i&&"undefined"!=typeof e.name){
var o=B(s.last(A(i,"label.name")));$.get(i,"class")==n&&e.name!=o&&(i=null)}var a=s.last(A(Tt,".subiz_conversionin > div"));if(a&&"text_notice_inline"==$.get(a,"class")&&(i=null),i&&$.get(i,"class")==n)r=""==e?'<div class="line_message"><span class="visitor_content_chat">'+t+"</span></div>":'<div class="line_message"><img src="'+ft(e.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+t+"</span></div>",H(i,r);else{if(""==e){var l="Me";c.lang.online.visitor_name&&(l=c.lang.online.visitor_name);

var f=c.visitor.name||l;r='<div class="visitor_chat"><label class="name"><a href="javascript:;" class="visitor_name">'+s.escape(f)+'</a></label><div class="line_message"><span class="visitor_content_chat">'+t+"</span></div></div>"}else r='<div class="supporter_chat"><label class="name">'+s.escape(e.name)+'</label><div class="line_message"><img src="'+ft(e.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+t+"</span></div></div>";N(Tt,"subiz_conversionin",function(e){H(e,r);

})}Nn()},yn=function(e){var t="input[type=text], textarea, select";"enable"==e?(A(Tt,t,function(e){$.remove(e,"disabled")}),A(Ct,t,function(e){$.remove(e,"disabled")})):(A(Tt,t,function(e){$.set(e,"disabled",!0)}),A(Ct,t,function(e){$.set(e,"disabled",!0)}))},wn=function(e){var t="message_welcome";e?N(Tt,t,function(e){G(e)}):N(Tt,t,function(e){W(e)})},xn=function(e){var t="subiz_loading";e?G(C(Tt,t)):W(C(Tt,t))},kn=function(e){var t="subiz_loading";e?G(C(Ct,t)):W(C(Ct,t))},zn=function(e){var t=".widget_body_footer .btnendchat";

e?A(Tt,t,function(e){G(e)}):A(Tt,t,function(e){W(e)})},En=function(e,t){var n="text_notice";e?s.each(c.agents,function(e){if(e.username==t){gt("UI typing : found agent");var i=c.lang.online.typing.replace("{agent}",s.escape(e.name));N(Tt,n,function(e){B(e,i),G(e)})}}):N(Tt,n,function(e){W(e)})},Tn=function(e){var t='<div class="text_notice_inline"><%= message %></div>',n={message:e},i=s.template(t,n);N(Tt,"subiz_conversionin",function(e){H(e,i)}),Nn()},Cn=function(e,t){t="undefined"==typeof t?"":"notification_"+t;

var n='<div class="chat_warning notification_widget '+t+'"><label class="name_chat_warning"><%= message %></label><a href="javascript:;" class="close_notification_widget"><i class="widget-sprites icon_actions icon_delete"></i></a></div>',i={message:e},r=s.template(n,i);"online"==u.status_widget?(N(Tt,"chat_warning",function(e){U(e)}),N(Tt,"widget_body_inner",function(e){H(e,r)})):(N(Ct,"chat_warning",function(e){U(e)}),N(Ct,"widget_body_inner",function(e){H(e,r)}))},Sn=function(e){var t="subiz-bubble";

e?G(C(Tt,t)):W(C(Tt,t))},jn=function(e){var t="logo_company";e?N(Tt,t,function(e){G(e)}):N(Tt,t,function(e){W(e)})},On=function(){var e="notice_new_message";N(Tt,e,function(e){B(e,"0"),W(e)}),ht()},Nn=function(){N(Tt,"subiz_conversionin",function(e){e.scrollHeight&&(e.scrollTop=e.scrollHeight)})};if(n[kt[3]]>0)for(n[kt[4]]();n[kt[3]];){var An=n[kt[5]]();Et(An)}e[kt[6]]={},e[kt[6]][zt]=Et}(this,document,_sbzq);